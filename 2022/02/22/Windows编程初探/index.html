<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="在逆向一些软件的时候，会涉及到Windows编程以及API的一些知识，以此初探windows编程">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows编程初探-了解win编程">
<meta property="og:url" content="http://example.com/2022/02/22/Windows%E7%BC%96%E7%A8%8B%E5%88%9D%E6%8E%A2/index.html">
<meta property="og:site_name" content="R-o-o-t-k-i-t">
<meta property="og:description" content="在逆向一些软件的时候，会涉及到Windows编程以及API的一些知识，以此初探windows编程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/02/22/Windows%E7%BC%96%E7%A8%8B%E5%88%9D%E6%8E%A2/1-14110Q0425B47.png">
<meta property="og:image" content="http://example.com/2022/02/22/Windows%E7%BC%96%E7%A8%8B%E5%88%9D%E6%8E%A2/1-14110Q0431R22.png">
<meta property="og:image" content="http://example.com/2022/02/22/Windows%E7%BC%96%E7%A8%8B%E5%88%9D%E6%8E%A2/1-14110Q043302b.png">
<meta property="og:image" content="http://example.com/2022/02/22/Windows%E7%BC%96%E7%A8%8B%E5%88%9D%E6%8E%A2/1-14110Q04345J6.png">
<meta property="article:published_time" content="2022-02-22T09:31:52.000Z">
<meta property="article:modified_time" content="2022-02-22T09:40:15.349Z">
<meta property="article:author" content="rootkit&#x2F;+-*">
<meta property="article:tag" content="Windows编程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/02/22/Windows%E7%BC%96%E7%A8%8B%E5%88%9D%E6%8E%A2/1-14110Q0425B47.png">


<link rel="canonical" href="http://example.com/2022/02/22/Windows%E7%BC%96%E7%A8%8B%E5%88%9D%E6%8E%A2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2022/02/22/Windows%E7%BC%96%E7%A8%8B%E5%88%9D%E6%8E%A2/","path":"2022/02/22/Windows编程初探/","title":"Windows编程初探-了解win编程"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Windows编程初探-了解win编程 | R-o-o-t-k-i-t</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">R-o-o-t-k-i-t</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-悠哉日常"><a href="/%E6%82%A0%E5%93%89%E6%97%A5%E5%B8%B8" rel="section"><i class="fa fa-user fa-fw"></i>悠哉日常</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#helloworld"><span class="nav-number">1.</span> <span class="nav-text">helloworld</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3"><span class="nav-number">3.</span> <span class="nav-text">窗口</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%A5%E6%9F%84"><span class="nav-number">3.1.</span> <span class="nav-text">句柄</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6"><span class="nav-number">3.2.</span> <span class="nav-text">消息机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-number">3.2.1.</span> <span class="nav-text">消息结构体</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MSG%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8CWndProc%E7%AA%97%E5%8F%A3%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="nav-number">4.</span> <span class="nav-text">MSG结构体和WndProc窗口过程详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MSG%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-number">4.1.</span> <span class="nav-text">MSG结构体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WndProc-%E7%AA%97%E5%8F%A3%E8%BF%87%E7%A8%8B"><span class="nav-number">4.2.</span> <span class="nav-text">WndProc 窗口过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3%E5%88%9B%E5%BB%BA"><span class="nav-number">5.</span> <span class="nav-text">窗口创建</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF"><span class="nav-number">5.1.</span> <span class="nav-text">思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E7%9A%84%E7%AA%97%E5%8F%A3"><span class="nav-number">5.2.</span> <span class="nav-text">完整的窗口</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E5%92%8C%E9%87%8D%E7%BB%98"><span class="nav-number">6.</span> <span class="nav-text">绘制和重绘</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WM-PAINT-%E6%B6%88%E6%81%AF"><span class="nav-number">6.1.</span> <span class="nav-text">WM_PAINT 消息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%89%E6%95%88%E7%9F%A9%E5%BD%A2%E5%92%8C%E6%97%A0%E6%95%88%E7%9F%A9%E5%BD%A2"><span class="nav-number">6.2.</span> <span class="nav-text">有效矩形和无效矩形</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%91%E7%AA%97%E5%8F%A3%E8%BE%93%E5%87%BA%E6%96%87%E5%AD%97%E2%80%94TextOut%E5%92%8CDrawText%E5%87%BD%E6%95%B0"><span class="nav-number">7.</span> <span class="nav-text">向窗口输出文字—TextOut和DrawText函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E5%A4%87%E7%8E%AF%E5%A2%83DC"><span class="nav-number">7.1.</span> <span class="nav-text">设备环境DC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BeginPaint-%E5%92%8C-EndPaint-%E5%87%BD%E6%95%B0"><span class="nav-number">7.2.</span> <span class="nav-text">BeginPaint 和 EndPaint 函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TextOut-%E5%87%BD%E6%95%B0"><span class="nav-number">7.3.</span> <span class="nav-text">TextOut 函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DrawText%E5%87%BD%E6%95%B0"><span class="nav-number">7.4.</span> <span class="nav-text">DrawText函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows-GDI%E7%BB%98%E5%9B%BE%E5%9F%BA%E7%A1%80%E4%B8%8E%E8%BD%BB%E9%87%8F%E8%BF%9B%E9%98%B6"><span class="nav-number">8.</span> <span class="nav-text">Windows GDI绘图基础与轻量进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#GDI-%E5%9F%BA%E7%A1%80"><span class="nav-number">8.1.</span> <span class="nav-text">GDI 基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E7%9F%A9%E5%BD%A2"><span class="nav-number">8.1.1.</span> <span class="nav-text">绘制矩形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E5%9C%86%E5%BD%A2"><span class="nav-number">8.1.2.</span> <span class="nav-text">绘制圆形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%A4%AD%E5%9C%86"><span class="nav-number">8.1.3.</span> <span class="nav-text">绘制椭圆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E7%9B%B4%E7%BA%BF"><span class="nav-number">8.1.4.</span> <span class="nav-text">绘制直线</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%BB%E7%AC%94%E5%92%8C%E7%94%BB%E5%88%B7"><span class="nav-number">8.2.</span> <span class="nav-text">画笔和画刷</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8%E7%94%BB%E7%AC%94"><span class="nav-number">8.2.1.</span> <span class="nav-text">创建和使用画笔</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GDI%E5%AF%B9%E8%B1%A1"><span class="nav-number">8.2.2.</span> <span class="nav-text">GDI对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8%E7%94%BB%E5%88%B7"><span class="nav-number">8.2.3.</span> <span class="nav-text">创建和使用画刷</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows-static%E6%8E%A7%E4%BB%B6"><span class="nav-number">9.</span> <span class="nav-text">Windows static控件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E3%80%81%E4%BF%AE%E6%94%B9%E6%8E%A7%E4%BB%B6%E6%96%87%E6%9C%AC"><span class="nav-number">9.1.</span> <span class="nav-text">获取、修改控件文本</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows-CreateFont%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%AD%97%E4%BD%93"><span class="nav-number">10.</span> <span class="nav-text">Windows CreateFont：创建自己的字体</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows-button%E6%8E%A7%E4%BB%B6%EF%BC%88%E6%8C%89%E9%92%AE%E6%8E%A7%E4%BB%B6%EF%BC%89"><span class="nav-number">11.</span> <span class="nav-text">Windows button控件（按钮控件）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows-edit%E6%8E%A7%E4%BB%B6%EF%BC%88%E7%BC%96%E8%BE%91%E6%A1%86%E6%8E%A7%E4%BB%B6%EF%BC%89"><span class="nav-number">12.</span> <span class="nav-text">Windows edit控件（编辑框控件）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9static%E6%8E%A7%E4%BB%B6%E8%83%8C%E6%99%AF%E9%A2%9C%E8%89%B2%E5%92%8C%E6%96%87%E5%AD%97%E9%A2%9C%E8%89%B2"><span class="nav-number">13.</span> <span class="nav-text">修改static控件背景颜色和文字颜色</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E5%AD%97%E8%83%8C%E6%99%AF%E9%A2%9C%E8%89%B2"><span class="nav-number">13.1.</span> <span class="nav-text">修改文字背景颜色</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%8F%E6%98%8E%E8%83%8C%E6%99%AF"><span class="nav-number">13.2.</span> <span class="nav-text">透明背景</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows%E5%8D%95%E9%80%89%E6%8C%89%E9%92%AE%E3%80%81%E5%A4%8D%E9%80%89%E6%A1%86%E3%80%81%E5%88%86%E7%BB%84%E6%A1%86%E6%8E%A7%E4%BB%B6"><span class="nav-number">14.</span> <span class="nav-text">Windows单选按钮、复选框、分组框控件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E6%A1%86%E6%8E%A7%E4%BB%B6"><span class="nav-number">14.1.</span> <span class="nav-text">分组框控件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E5%8D%95%E9%80%89%E6%8C%89%E9%92%AE%E5%92%8C%E5%A4%8D%E9%80%89%E6%A1%86%E6%98%AF%E5%90%A6%E8%A2%AB%E9%80%89%E4%B8%AD"><span class="nav-number">15.</span> <span class="nav-text">判断单选按钮和复选框是否被选中</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="rootkit/+-*"
      src="/images/head.jpg">
  <p class="site-author-name" itemprop="name">rootkit/+-*</p>
  <div class="site-description" itemprop="description">自由，平等，公正，法制</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      统一战线
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://jnsec.org/" title="https:&#x2F;&#x2F;jnsec.org&#x2F;" rel="noopener" target="_blank">JNSEC</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.yd0ng.com/" title="https:&#x2F;&#x2F;blog.yd0ng.com" rel="noopener" target="_blank">yd0ng</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://1klnd.github.io/" title="https:&#x2F;&#x2F;1klnd.github.io&#x2F;" rel="noopener" target="_blank">III</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://blog.brvc3.website/" title="http:&#x2F;&#x2F;blog.brvc3.website&#x2F;" rel="noopener" target="_blank">Bruce</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://tty-flag.github.io/" title="https:&#x2F;&#x2F;tty-flag.github.io&#x2F;" rel="noopener" target="_blank">TTY</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://rave1sking.top/" title="http:&#x2F;&#x2F;rave1sking.top&#x2F;" rel="noopener" target="_blank">Rava</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/weixin_45396639" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_45396639" rel="noopener" target="_blank">Ronie</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/qq_42880719" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_42880719" rel="noopener" target="_blank">Mumuzi</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.squidward.xyz/" title="https:&#x2F;&#x2F;www.squidward.xyz&#x2F;" rel="noopener" target="_blank">Octopus</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://k1tcheung.github.io/" title="https:&#x2F;&#x2F;k1tcheung.github.io&#x2F;" rel="noopener" target="_blank">k1tcheung</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://rhoeo.github.io/" title="https:&#x2F;&#x2F;rhoeo.github.io&#x2F;" rel="noopener" target="_blank">Rhoeo</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://abiao2002.github.io/" title="https:&#x2F;&#x2F;abiao2002.github.io&#x2F;" rel="noopener" target="_blank">Abiao</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://giles-one.github.io/" title="https:&#x2F;&#x2F;giles-one.github.io&#x2F;" rel="noopener" target="_blank">Cat03</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://reimu.moe/" title="https:&#x2F;&#x2F;reimu.moe&#x2F;" rel="noopener" target="_blank">加大号的猫</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.baidu.com/" title="https:&#x2F;&#x2F;www.baidu.com" rel="noopener" target="_blank">有问题点这里</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://bing.com/" title="https:&#x2F;&#x2F;bing.com" rel="noopener" target="_blank">没有解决？</a>
        </li>
    </ul>
  </div>

          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/22/Windows%E7%BC%96%E7%A8%8B%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpg">
      <meta itemprop="name" content="rootkit/+-*">
      <meta itemprop="description" content="自由，平等，公正，法制">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R-o-o-t-k-i-t">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Windows编程初探-了解win编程
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-02-22 17:31:52 / 修改时间：17:40:15" itemprop="dateCreated datePublished" datetime="2022-02-22T17:31:52+08:00">2022-02-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p> 在逆向一些软件的时候，会涉及到Windows编程以及API的一些知识，以此初探windows编程</p>
<span id="more"></span>
<h1 id="helloworld"><a href="#helloworld" class="headerlink" title="helloworld"></a>helloworld</h1><p>1.编写Windows程序，需要<windows.h>头文件，这个文件包括了四个文件</p>
<ul>
<li>windef.h：基本类型定义</li>
<li>winbase.h：内核函数</li>
<li>wingdi.h：用户接口函数</li>
<li>winuser.h： 图形设备接口函数</li>
</ul>
<p>所有的API都在这些头文件中声明</p>
<p>2.程序入口</p>
<p>控制台程序（console）程序的入口是<strong>main函数</strong>；GUI程序的入口是<strong>WinMain()</strong>（动态链接库(DLL)以 DllMain() 为入口函数）</p>
<p><strong>WinMain函数原型</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hInstance,  <span class="comment">// 当前窗口句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hPrevInstance,  <span class="comment">// 前一个窗口句柄，Win32下为NULL（Win16留下的废物，目前已弃用）</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPSTR lpCmdLine,  <span class="comment">// 命令行参数</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nCmdShow  	  <span class="comment">// 窗口显示方式</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>句柄：用来告诉程序去哪里寻找需要的数据（不是指针）</p>
<p>3.第一个程序</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hPrevInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPSTR lpCmdLine,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nCmdShow</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 调用API 函数MessageBox</span></span><br><span class="line">    <span class="keyword">int</span> nSelect = MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;Hello World\n烫&quot;</span>), TEXT(<span class="string">&quot;first GUI&quot;</span>), MB_OKCANCEL);</span><br><span class="line">    <span class="keyword">if</span> (nSelect == IDOK) </span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;你点击了“确定”按钮&quot;</span>), TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;你点击了“取消”按钮&quot;</span>), TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MessageBox() 函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">MessageBox</span><span class="params">( HWND hWnd, LPCTSTR lpText, LPCTSTR lpCaption, UINT uType )</span></span>;</span><br></pre></td></tr></table></figure>
<p>可以知道，该api的返回值是int类型，代表了一个按钮消息</p>
<ul>
<li>hWnd：该消息框的父窗口句柄，如果此参数为NULL，则该消息框没有拥有父窗口。</li>
<li><strong>lpText：消息框的内容。LPCTSTR 是自定义数据类型，等价于 const char *。</strong></li>
<li><strong>lpCaption：消息框的标题。</strong></li>
<li><strong>uType：对话框的按钮样式和图标。</strong></li>
</ul>
<p>4.按钮的类型</p>
<p>微软给出了几种默认的按钮类型（MB_按钮的作用）</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>按钮</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>0：MB_OK</td>
<td><strong>默认值</strong>，有一个“确认”按钮在里面</td>
</tr>
<tr>
<td>1：MB_YESNO</td>
<td>有“是”和“否”两个按钮</td>
</tr>
<tr>
<td>2：MB_ABORTRETRYIGNORE</td>
<td>有“中止”，“重试”和“跳过”三个按钮</td>
</tr>
<tr>
<td>3：MB_YESNOCANCEL</td>
<td>有“是”，“否”和“取消”三个按钮</td>
</tr>
<tr>
<td>4：MB_RETRYCANCEL</td>
<td>有“重试”和“取消”两个按钮</td>
</tr>
<tr>
<td>5：MB_OKCANCEL</td>
<td>有“确定”和“取消”两个按钮</td>
</tr>
</tbody>
</table>
</div>
<p>uType 还图标（图标对用户有提醒作用）：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>图标</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>MB_ICONEXCLAMATION</td>
<td>一个惊叹号出现在消息框：<img src="1-14110Q0425B47.png" alt="img"></td>
</tr>
<tr>
<td>MB_ICONWARNING</td>
<td>一个惊叹号出现在消息框（同上）</td>
</tr>
<tr>
<td>MB_ICONINFORMATION</td>
<td>一个圆圈中小写字母i组成的图标出现在消息框：<img src="1-14110Q0431R22.png" alt="img"></td>
</tr>
<tr>
<td>MB_ICONASTERISK</td>
<td>一个圆圈中小写字母i组成的图标出现在消息框（同上）</td>
</tr>
<tr>
<td>MB_ICONQUESTION</td>
<td>一个问题标记图标出现在消息框：<img src="1-14110Q043302b.png" alt="img"></td>
</tr>
<tr>
<td>MB_ICONSTOP</td>
<td>一个停止消息图标出现在消息框：<img src="1-14110Q04345J6.png" alt="img"></td>
</tr>
<tr>
<td>MB_ICONERROR</td>
<td>一个停止消息图标出现在消息框（同上）</td>
</tr>
<tr>
<td>MB_ICONHAND</td>
<td>一个停止消息图标出现在消息框（同上）</td>
</tr>
</tbody>
</table>
</div>
<p>图标和按钮混合使用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">int</span> nSelect = MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;Hello World\nlallalalallalalalla烫&quot;</span>), TEXT(<span class="string">&quot;first GUI&quot;</span>), MB_OKCANCEL|MB_ICONEXCLAMATION);</span><br><span class="line"><span class="comment">//用一个 | 符号</span></span><br></pre></td></tr></table></figure>
<p>5.注意，messagebox虽然返回数字，但是被定义为宏，所以可以使用数字或者宏名称</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>返回值</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>IDOK</td>
<td>用户按下了“确认”按钮</td>
</tr>
<tr>
<td>IDCANCEL</td>
<td>用户按下了“取消”按钮</td>
</tr>
<tr>
<td>IDABORT</td>
<td>用户按下了“中止”按钮</td>
</tr>
<tr>
<td>IDRETRY</td>
<td>用户按下了“重试”按钮</td>
</tr>
<tr>
<td>IDIGNORE</td>
<td>用户按下了“忽略”按钮</td>
</tr>
<tr>
<td>IDYES</td>
<td>用户按下了“是”按钮</td>
</tr>
<tr>
<td>IDNO</td>
<td>用户按下了“否”按钮</td>
</tr>
</tbody>
</table>
</div>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><p>1.Windows使用<code>typedef</code>或<code>#define</code>定了很多新的数据类型，但是大多数都是基本数据类型的新名字，这样作可以提高兼容性</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span>                 INT;       <span class="comment">/* 整形 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span>        UINT;      <span class="comment">/* 无符号整形 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span>        *PUINT;    <span class="comment">/* 无符号整形指针 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span>                 BOOL;      <span class="comment">/* 布尔类型 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span>       BYTE;      <span class="comment">/* 字节 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">short</span>      WORD;      <span class="comment">/* WORD (无符号短整型) */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span>       DWORD;     <span class="comment">/* DOUBLE WORD (无符号长整形)*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">float</span>               FLOAT;     <span class="comment">/* 浮点型 */</span></span><br><span class="line"><span class="keyword">typedef</span> FLOAT               *PFLOAT;   <span class="comment">/* 指向float类型指针 */</span></span><br><span class="line"><span class="keyword">typedef</span> BOOL near           *PBOOL;    <span class="comment">/* 指向布尔类型指针 */</span></span><br><span class="line"><span class="keyword">typedef</span> BOOL far            *LPBOOL;</span><br><span class="line"><span class="keyword">typedef</span> BYTE near           *PBYTE;    <span class="comment">/* 指向字节类型指针 */</span></span><br><span class="line"><span class="keyword">typedef</span> BYTE far            *LPBYTE;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> near            *PINT;     <span class="comment">/* 整形指针 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> far             *LPINT;</span><br><span class="line"><span class="keyword">typedef</span> WORD near           *PWORD;    <span class="comment">/* 指向WORD类型的指针 */</span></span><br><span class="line"><span class="keyword">typedef</span> WORD far            *LPWORD;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> far            *LPLONG;   <span class="comment">/* 指向长整形的指针 */</span></span><br><span class="line"><span class="keyword">typedef</span> DWORD near          *PDWORD;   <span class="comment">/* 指向DWORD类型的指针 */</span></span><br><span class="line"><span class="keyword">typedef</span> DWORD far           *LPDWORD;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> far            *LPVOID;   <span class="comment">/* 指向void类型的指针 */</span></span><br><span class="line"><span class="keyword">typedef</span> CONST <span class="keyword">void</span> far      *LPCVOID;  <span class="comment">/* 指向void类型的常指针 */</span></span><br></pre></td></tr></table></figure>
<p>可以总结一下规律就是</p>
<ul>
<li>无符号类型：一般是以“U”开头，比如“INT”对应的“UINT”。</li>
<li>指针类型：其指向的数据类型前加“LP”或“P”，比如指向 DWORD 的指针类为“LPDWORD”和“PDWORD”。</li>
<li>句柄类型：以“H”开头。比如，HWND 是window（WND简写）也就是窗口的句柄，菜单(MENU)类型对应的句柄类型为 “HMENU” 等等。</li>
</ul>
<p>2.宽字节和unicode</p>
<p>unicode是宽字节编码的一种，需要用<strong>多个字节来表示的代码称为宽字符</strong></p>
<p>2.1 使用宽字符</p>
<p>使用<code>wchar.h</code>头文件中的<code>wchar_t</code>来定义宽字符</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wchar.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    <span class="keyword">wchar_t</span> wch = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    <span class="keyword">char</span> str[] = <span class="string">&quot;C语言中文网&quot;</span>;</span><br><span class="line">    <span class="keyword">wchar_t</span> wstr[] = <span class="string">L&quot;C语言中文网&quot;</span>; <span class="comment">//L是前缀，告诉编译器这是两字节</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ch=%d, wch=%d, str=%d, wstr=%d\n&quot;</span>, </span><br><span class="line">           <span class="keyword">sizeof</span>(ch), <span class="keyword">sizeof</span>(wch), <span class="keyword">sizeof</span>(str), <span class="keyword">sizeof</span>(wstr));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：ch=1, wch=2, str=12, wstr=14</p>
<p>wstr 之所以比 str 多两个字节是因为：字符 ‘C’ 占用两个字节，字符串结束标志 ‘\0’ 也占用两个字节。</p>
<p>2.2 计算ASCII字符串长度使用 strlen 函数，计算宽字符串长度使用 wcslen 函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[] = <span class="string">&quot;Hello API&quot;</span>;</span><br><span class="line">    <span class="keyword">wchar_t</span> wstr[] = <span class="string">L&quot;Hello API&quot;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;strlen(str)=%d, wcslen(wstr)=%d\n&quot;</span>, <span class="built_in">strlen</span>(str), wcslen(wstr));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>strlen函数将一字节算作是一个字符，wcslen将两个字节算成一个字符</p>
<h1 id="窗口"><a href="#窗口" class="headerlink" title="窗口"></a>窗口</h1><p>窗口、控件、图像、音频视频等都称为<strong>资源(Resource)</strong>，在程序中都可以使用、创建、添加、修改等。</p>
<h2 id="句柄"><a href="#句柄" class="headerlink" title="句柄"></a>句柄</h2><p>不同窗口、控件、图像等都对应一个唯一的数字（初学者可以理解为 ID），称为句柄(Handle)。</p>
<p>通过句柄，程序可以找对对应的信息。例如：例如用 <code>CreateFile()</code> 函数创建文件后会返回一个文件句柄，然后通过这个句柄就可以读写、删除该文件.</p>
<h2 id="消息机制"><a href="#消息机制" class="headerlink" title="消息机制"></a>消息机制</h2><p>1.事件：用户敲击键盘、点击鼠标、拖动窗口、选择菜单、输入文字等所有的操作都称为事件(Event)。</p>
<p>2.当事件发生时，windows会产生一条<strong>信息</strong>，告诉程序发生了什么。</p>
<p>3.每当事件发生时，Windows 会生成一条消息，并放到一个由<strong>系统维护的队列中</strong>。然后，<strong>程序会自己从这个队列中获取消息并分析</strong>，调用事件处理函数（处理事件的代码也就在这个函数中），对用户的操作进行响应。</p>
<p>4.队列：先进先出的数据结构</p>
<p><strong><em>注意：Windows 向队列中分派消息和应用程序从队列中获取消息并不是同步的，只要有事件发生，就会将消息丢进队列，什么时候处理完毕是应用程序的事。</em></strong></p>
<p>总结：消息是windows连接程序的桥梁，Windows通过 <strong>消息</strong> 告诉程序发生了什么，应用程序通过 <strong>消息</strong> 来办事。</p>
<h3 id="消息结构体"><a href="#消息结构体" class="headerlink" title="消息结构体"></a>消息结构体</h3><p>消息其实是一个结构体，名字为 MSG，定义为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagMSG</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    HWND hwnd;	<span class="comment">//消息所属窗口</span></span><br><span class="line">    UINT message;	<span class="comment">//消息类型（数值）</span></span><br><span class="line">    WPARAM wParam;	<span class="comment">//同下</span></span><br><span class="line">    LPARAM lParam;	<span class="comment">//表示的信息随消息的不同而不同。</span></span><br><span class="line">    DWORD time;	<span class="comment">//消息投递到消息队列中的时间</span></span><br><span class="line">    POINT pt;	<span class="comment">//鼠标当前位置</span></span><br><span class="line">&#125; MSG;</span><br></pre></td></tr></table></figure>
<p>Windows 向队列中投递消息，其实就是将一个<strong>类型为 MSG 的结构体变量</strong>丢进队列。</p>
<p>1.message：因为数值不好记忆，所有Windows<strong>将消息对应的数值定义为WM_XXX宏</strong>（WM是Window Message的缩写）的形式。例如：鼠标左键按下消息是WM_LBUTTONDOWN；键盘按下消息WM_KEYDOWN；字符消息是WM_CHA。在程序中我们通常都是以WM_XXX宏的形式来使用消息的。</p>
<h1 id="MSG结构体和WndProc窗口过程详解"><a href="#MSG结构体和WndProc窗口过程详解" class="headerlink" title="MSG结构体和WndProc窗口过程详解"></a>MSG结构体和WndProc窗口过程详解</h1><h2 id="MSG结构体"><a href="#MSG结构体" class="headerlink" title="MSG结构体"></a>MSG结构体</h2><p>MSG 结构体用来表示一条消息，各个字段的含义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagMSG</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    HWND hwnd;  <span class="comment">//窗口句柄</span></span><br><span class="line">    UINT message;  <span class="comment">//消息类型，例如 WM_CREATE、WM_PAINT、WM_DESTROY、WM_COMMAND 等。</span></span><br><span class="line">    WPARAM wParam;  <span class="comment">//附加消息1</span></span><br><span class="line">    LPARAM lParam;  <span class="comment">//附加消息2，他们的类型表示32位整数</span></span><br><span class="line">    DWORD time;  <span class="comment">//消息被传递时候的时间</span></span><br><span class="line">    POINT  pt;  <span class="comment">//消息被传递时光标在屏幕上的位置</span></span><br><span class="line">&#125; MSG;</span><br></pre></td></tr></table></figure>
<p>1.wParam 和 lParam ：wParam、lParam 表示的信息随消息类型的不同而不同。</p>
<p>2.一般约定，wParam 用来表示控件的ID，或者高 16 位和低 16 位组合起来分别表示鼠标的位置，如果发送消息时需要附带某种结构的指针或者是某种类型的句柄时，习惯上用 lParam。</p>
<h2 id="WndProc-窗口过程"><a href="#WndProc-窗口过程" class="headerlink" title="WndProc 窗口过程"></a>WndProc 窗口过程</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hwnd,  <span class="comment">//窗口句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    UINT message,  <span class="comment">//消息类型</span></span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,  <span class="comment">//附加消息1</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam  <span class="comment">//附加消息2</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>&#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：WndProc 的各个参数和 MSG 结构体的前四个字段是一一对应的。需要铭记的是：每产生<strong>一条消息，都会调用一次 WndProc 函数。</strong></p>
<p>2.当用户点击按钮、编辑框、下拉列表框等控件的时候，会产生WM_COMMAND消息。对于不同来源的 WM_COMMAND 消息，wParam、lParam 参数也不同，见下表：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>消息来源</th>
<th>wParam (高16位)</th>
<th>wParam (低16位)</th>
<th>lParam</th>
</tr>
</thead>
<tbody>
<tr>
<td>菜单</td>
<td>0</td>
<td>菜单ID</td>
<td>0</td>
</tr>
<tr>
<td>快捷键</td>
<td>1</td>
<td>快捷键ID</td>
<td>0</td>
</tr>
<tr>
<td>控件</td>
<td>控件通知码</td>
<td>控件ID</td>
<td>控件句柄</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>控件通知码用来识别控件的操作。例如 Button 控件一般有两种通知码，BN_CLICKED 和 BN_DOUBLECLICKED，前者表示 Button 被单击，后者表示 Button 被双击。</li>
</ul>
<p>3.对于 Button 控件，我们可以通过<code>LOWORD(wParam)</code>来获取它的 ID。</p>
<h1 id="窗口创建"><a href="#窗口创建" class="headerlink" title="窗口创建"></a>窗口创建</h1><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ul>
<li>定义 <code>WinMain</code> 函数</li>
<li>定义 <strong>窗口处理函数</strong></li>
<li>注册窗口类</li>
<li>创建窗口</li>
<li>显示窗口</li>
<li>消息循环</li>
<li>消息处理</li>
</ul>
<h2 id="完整的窗口"><a href="#完整的窗口" class="headerlink" title="完整的窗口"></a>完整的窗口</h2><p>一般的窗口包括有：最大化、最小化、关闭按钮，也包含菜单、单选框、图像等各种控件。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hPrevInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">    PSTR szCmdLine,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> iCmdShow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> TCHAR szClassName[] = TEXT(<span class="string">&quot;HelloWin&quot;</span>);  <span class="comment">//窗口类名</span></span><br><span class="line">    HWND     hwnd;  <span class="comment">//窗口句柄</span></span><br><span class="line">    MSG      msg;  <span class="comment">//消息</span></span><br><span class="line">    WNDCLASS wndclass;  <span class="comment">//窗口类</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**********第①步：注册窗口类**********/</span>  </span><br><span class="line">    <span class="comment">//创建的窗口各不相同，windows把通用属性抽取出来用结构体表示</span></span><br><span class="line">    <span class="comment">//为窗口类的各个字段赋值</span></span><br><span class="line">    wndclass.style = CS_HREDRAW | CS_VREDRAW;  <span class="comment">//窗口风格</span></span><br><span class="line">    wndclass.lpfnWndProc  = WndProc;  <span class="comment">//窗口过程</span></span><br><span class="line">    wndclass.cbClsExtra   = <span class="number">0</span>;  <span class="comment">//暂时不需要理解</span></span><br><span class="line">    wndclass.cbWndExtra   = <span class="number">0</span>;  <span class="comment">//暂时不需要理解</span></span><br><span class="line">    wndclass.hInstance    = hInstance;  <span class="comment">//当前窗口句柄</span></span><br><span class="line">    wndclass.hIcon        = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);  <span class="comment">//窗口图标</span></span><br><span class="line">    wndclass.hCursor      = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW);  <span class="comment">//鼠标样式</span></span><br><span class="line">    wndclass.hbrBackground= (HBRUSH) GetStockObject (WHITE_BRUSH);  <span class="comment">//窗口背景画刷</span></span><br><span class="line">    wndclass.lpszMenuName = <span class="literal">NULL</span> ;  <span class="comment">//窗口菜单</span></span><br><span class="line">    wndclass.lpszClassName= szClassName;  <span class="comment">//窗口类名</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//注册窗口</span></span><br><span class="line">    RegisterClass(&amp;wndclass);</span><br><span class="line">    <span class="comment">//窗口类仅仅是一个结构体，如果只定义了结构体变量，那么在使用时并不能通过 lpszClassName 字段的值找到这个结构体。所以还要调用 RegisterClass() 来注册，让系统知道窗口类的名字，下次使用时才能找到。</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*****第②步：创建窗口(并让窗口显示出来)*****/</span></span><br><span class="line">    hwnd = CreateWindow(</span><br><span class="line">        szClassName,  <span class="comment">//窗口类的名字</span></span><br><span class="line">        TEXT(<span class="string">&quot;Welcome&quot;</span>),  <span class="comment">//窗口标题（出现在标题栏）</span></span><br><span class="line">        WS_OVERLAPPEDWINDOW,  <span class="comment">//窗口风格</span></span><br><span class="line">        CW_USEDEFAULT,  <span class="comment">//初始化时x轴的位置</span></span><br><span class="line">        CW_USEDEFAULT,  <span class="comment">//初始化时y轴的位置</span></span><br><span class="line">        <span class="number">500</span>,  <span class="comment">//窗口宽度</span></span><br><span class="line">        <span class="number">300</span>,  <span class="comment">//窗口高度</span></span><br><span class="line">        <span class="literal">NULL</span>,  <span class="comment">//父窗口句柄</span></span><br><span class="line">        <span class="literal">NULL</span>,  <span class="comment">//窗口菜单句柄</span></span><br><span class="line">        hInstance,  <span class="comment">//当前窗口的句柄</span></span><br><span class="line">        <span class="literal">NULL</span>  <span class="comment">//不使用该值</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//显示窗口</span></span><br><span class="line">    ShowWindow (hwnd, iCmdShow);</span><br><span class="line">    <span class="comment">//更新（绘制）窗口</span></span><br><span class="line">    UpdateWindow (hwnd);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**********第③步：消息循环**********/</span></span><br><span class="line">    <span class="keyword">while</span>( GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">        TranslateMessage(&amp;msg);  <span class="comment">//翻译消息</span></span><br><span class="line">        DispatchMessage (&amp;msg);  <span class="comment">//分派消息</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> msg.wParam;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********第④步：窗口过程**********/</span></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span>&#123;</span><br><span class="line">    HDC         hdc;  <span class="comment">//设备环境句柄</span></span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    RECT        rect;</span><br><span class="line">    <span class="keyword">switch</span> (message)&#123;</span><br><span class="line">        <span class="comment">//窗口绘制消息</span></span><br><span class="line">        <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">            hdc = BeginPaint (hwnd, &amp;ps) ;</span><br><span class="line">            GetClientRect (hwnd, &amp;rect) ;</span><br><span class="line">            DrawText(</span><br><span class="line">                hdc,</span><br><span class="line">                TEXT(<span class="string">&quot;第一个win api程序&quot;</span>),</span><br><span class="line">                <span class="number">-1</span>,</span><br><span class="line">                &amp;rect,</span><br><span class="line">                DT_SINGLELINE | DT_CENTER | DT_VCENTER</span><br><span class="line">            );</span><br><span class="line">            EndPaint (hwnd, &amp;ps) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="comment">//窗口销毁消息</span></span><br><span class="line">        <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">            PostQuitMessage(<span class="number">0</span>) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> DefWindowProc(hwnd, message, wParam, lParam) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注册窗口类</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">WNDCLASS wndclass;  <span class="comment">//窗口类</span></span><br><span class="line">    <span class="comment">//创建的窗口各不相同，windows把通用属性抽取出来用结构体表示</span></span><br><span class="line">    <span class="comment">//为窗口类的各个字段赋值</span></span><br><span class="line">    wndclass.style = CS_HREDRAW | CS_VREDRAW;  </span><br><span class="line">	<span class="comment">//窗口风格，这里的取值表示窗口大小改变时重绘窗口，确保内容在中间</span></span><br><span class="line">    wndclass.lpfnWndProc  = WndProc;  </span><br><span class="line">	<span class="comment">//窗口过程</span></span><br><span class="line">    wndclass.cbClsExtra   = <span class="number">0</span>;  <span class="comment">//暂时不需要理解</span></span><br><span class="line">    wndclass.cbWndExtra   = <span class="number">0</span>;  <span class="comment">//暂时不需要理解</span></span><br><span class="line">    wndclass.hInstance    = hInstance;  </span><br><span class="line">	<span class="comment">//当前窗口句柄</span></span><br><span class="line">    wndclass.hIcon        = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);  </span><br><span class="line">	<span class="comment">//窗口图标，需要用loadicon来加载</span></span><br><span class="line">    wndclass.hCursor      = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW);  </span><br><span class="line">	<span class="comment">//鼠标样式</span></span><br><span class="line">    wndclass.hbrBackground= (HBRUSH) GetStockObject (WHITE_BRUSH);  </span><br><span class="line">	<span class="comment">//窗口背景画刷，窗口背景的颜色</span></span><br><span class="line">    wndclass.lpszMenuName = <span class="literal">NULL</span> ;  </span><br><span class="line">	<span class="comment">//窗口菜单，没有菜单就是null</span></span><br><span class="line">    wndclass.lpszClassName= szClassName;  </span><br><span class="line">	<span class="comment">//窗口类名，方便于其他窗口进行区分</span></span><br></pre></td></tr></table></figure>
<p><strong>创建窗口</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hwnd = CreateWindow(</span><br><span class="line">    szClassName,  <span class="comment">// 窗口类的名字，通过这个名字可以找到刚才注册的窗口类</span></span><br><span class="line">    TEXT(<span class="string">&quot;Welcome&quot;</span>),  <span class="comment">//窗口标题（出现在标题栏）</span></span><br><span class="line">    WS_OVERLAPPEDWINDOW,  <span class="comment">//窗口风格</span></span><br><span class="line">    CW_USEDEFAULT,  <span class="comment">//初始化时窗口x轴坐标</span></span><br><span class="line">    CW_USEDEFAULT,  <span class="comment">//初始化时窗口y轴坐标</span></span><br><span class="line">    <span class="number">500</span>,  <span class="comment">//窗口宽度</span></span><br><span class="line">    <span class="number">300</span>,  <span class="comment">//窗口高度</span></span><br><span class="line">    <span class="literal">NULL</span>,  <span class="comment">//父窗口句柄。这里没有父窗口，所以为 NULL</span></span><br><span class="line">    <span class="literal">NULL</span>,  <span class="comment">//窗口菜单句柄。当前窗口没有菜单，所以为 NULL</span></span><br><span class="line">    hInstance,  <span class="comment">//当前窗口的句柄，通过 WinMain 函数传入。</span></span><br><span class="line">    <span class="literal">NULL</span>  <span class="comment">//不使用该值</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>显示器坐标远点在左上角，横为x，竖为y，没有负数</p>
<p>上述函数只是在内存中创建了窗口，分配了空间，获得了句柄，做好了准备工作，但是并不能显示</p>
<p><strong>显示窗口</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ShowWindow(hWnd, iCmdShow)<span class="comment">//hWnd:指窗口句柄。nCmdShow：指定窗口如何显示。</span></span><br></pre></td></tr></table></figure>
<p><strong>消息循环</strong></p>
<p>在 UpdateWindow 函数被调用之后，新建的窗口在屏幕中就可以显示了。</p>
<p>此时，程序必须能够<strong>接受用户的键盘或鼠标事件</strong>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>( GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>) )<span class="comment">//GetMessage 函数用来从消息队列中获取一条消息，并保存到 MSG 结构体变量中。</span></span><br><span class="line">&#123;</span><br><span class="line">    TranslateMessage(&amp;msg);  <span class="comment">//翻译消息</span></span><br><span class="line">    DispatchMessage (&amp;msg);  <span class="comment">//分派消息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.GetMessage 的返回值永远为非零值，while 循环会一直进行下去。<strong>如果队列中没有消息，GetMessage 函数会等待，</strong>直到有消息进入。</p>
<p>2.获取到消息后，需要调用 TranslateMessage 函数对消息进行转换（翻译），然后再调用 DispatchMessage 函数将消息传给窗口过程去处理（调用窗口过程）。</p>
<p><strong>窗口过程</strong></p>
<p>1.就是处理窗口事件的函数，也就是上面代码中最后的 WndProc 函数。</p>
<p>2.GetMessage 每获取到一条消息，最终都会丢给窗口过程去处理。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HDC         hdc;  <span class="comment">//设备环境句柄</span></span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    RECT        rect;</span><br><span class="line">    <span class="keyword">switch</span> (message)<span class="comment">//不同的消息往往需要进行不同的处理，所以一般通过 switch case 语句来匹配。</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//窗口绘制消息</span></span><br><span class="line">        <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">            hdc = BeginPaint (hwnd, &amp;ps) ;</span><br><span class="line">            GetClientRect (hwnd, &amp;rect) ;</span><br><span class="line">            DrawText(</span><br><span class="line">                hdc,</span><br><span class="line">                TEXT(<span class="string">&quot;第一个win api程序&quot;</span>),</span><br><span class="line">                <span class="number">-1</span>,</span><br><span class="line">                &amp;rect,</span><br><span class="line">                DT_SINGLELINE | DT_CENTER | DT_VCENTER</span><br><span class="line">            );</span><br><span class="line">            EndPaint (hwnd, &amp;ps) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//窗口销毁消息</span></span><br><span class="line">        <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">            PostQuitMessage(<span class="number">0</span>) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> DefWindowProc(hwnd, message, wParam, lParam) ;</span><br><span class="line">    <span class="comment">//让Windows自己处理应用程序没有处理的消息，必须要有该语句。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="绘制和重绘"><a href="#绘制和重绘" class="headerlink" title="绘制和重绘"></a>绘制和重绘</h1><p>1.当用户在屏幕移动其他程序的窗口时，遮住当前程序的部分窗口。Windows 不会保存被遮住的那部分窗口，当其他程序的窗口被移开时，Windows 会要求你的程序重新绘制刚才被遮住的部分区域。如果你自己不重绘，Windows 是不会管的。</p>
<p><strong>并不是简单的遮挡关系</strong></p>
<p>2.Windows 是一个消息驱动的系统，它使用两种方式把各种事件通知给应用程序：</p>
<ul>
<li>把消息放到应用程序的消息队列中，让程序自己通过 GetMessage 函数获取；</li>
<li>向窗口直接发送消息。</li>
</ul>
<h2 id="WM-PAINT-消息"><a href="#WM-PAINT-消息" class="headerlink" title="WM_PAINT 消息"></a>WM_PAINT 消息</h2><p>1.<strong>WM_PAINT 消息表示绘制窗口的客户区</strong>。</p>
<p>以下任何一个事件发生时，窗口过程都会收到一条 WM_PAINT 消息：</p>
<ul>
<li>用户移动一个窗口，导致原来被遮住的部分窗口暴露出来。</li>
<li>用户调整窗口的大小（当窗口类中 style 字段的值设定为 CS_HREDRAW | CS_VREDRAW 时）。</li>
<li>客户区滚动条滚动时。</li>
<li>当然，你可以可以调用相应的函数强制生成一条 WM_PAINT 消息。</li>
</ul>
<p>注意：<strong>窗口类中 style 字段的值经常被设定为<code>CS_HREDRAW | CS_VREDRAW</code>，只有这样，调整窗口宽度或高度时才会发生重绘</strong>。</p>
<p>2.在少数情况下，Windows 总是会<strong>保存被覆盖的部分窗口，然后再恢复</strong>，例如：</p>
<ul>
<li>鼠标指针在客户区内移动。</li>
<li>在客户区内拖动图标。</li>
</ul>
<p><strong><em>在Windows中一切界面都是绘图，一旦界面发生改变，就需要重新绘制。</em></strong></p>
<h2 id="有效矩形和无效矩形"><a href="#有效矩形和无效矩形" class="headerlink" title="有效矩形和无效矩形"></a>有效矩形和无效矩形</h2><p>1.Windows 一般不重绘整个客户区，而是绘制客户区的一部分。需要重新绘制的部分被称为<strong>“无效区域”或“更新区域”</strong></p>
<p>在绘制的时候，会将无效区域装进一个“最小矩形之中”，称为 <strong>无效矩形</strong></p>
<h1 id="向窗口输出文字—TextOut和DrawText函数"><a href="#向窗口输出文字—TextOut和DrawText函数" class="headerlink" title="向窗口输出文字—TextOut和DrawText函数"></a>向窗口输出文字—TextOut和DrawText函数</h1><h2 id="设备环境DC"><a href="#设备环境DC" class="headerlink" title="设备环境DC"></a>设备环境DC</h2><p>1.Windows不允许我们直接访问硬件，在与这些硬件通信前要获得设备环境（Device Context，简称 DC），进而间接的访问硬件。</p>
<blockquote>
<p>设备环境有时也被称为设备上下文或设备描述表。</p>
</blockquote>
<p>2.设备环境：与当前硬件设备有关的各种信息，它是硬件设备的抽象。</p>
<p>3.与文字输出、图形绘制有关的函数，在使用时大都需要传入一个参数，就是设备环境句柄。让程序知道往哪里输出</p>
<p>4.获取句柄：常用的是 BeginPaint 函数。绘图完成后，还要释放句柄，使用 EndPaint 函数。</p>
<h2 id="BeginPaint-和-EndPaint-函数"><a href="#BeginPaint-和-EndPaint-函数" class="headerlink" title="BeginPaint 和 EndPaint 函数"></a>BeginPaint 和 EndPaint 函数</h2><p>发生绘制事件时，程序通过bp函数通知windows当前程序需要显示器，bp函数执行完就返回显示器的句柄， 绘图之后，用ep函数通知windows绘图结束，可以往下走了。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HDC         hdc;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    RECT        rect;</span><br><span class="line">    <span class="keyword">switch</span> (message)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">            hdc = BeginPaint (hwnd, &amp;ps) ;	<span class="comment">//在这里开始绘制</span></span><br><span class="line">            GetClientRect (hwnd, &amp;rect) ;</span><br><span class="line">            <span class="comment">//GetClientRect 函数用来获得窗口客户区的坐标，也就是获得客户区这个矩形。</span></span><br><span class="line">            DrawText(</span><br><span class="line">                hdc,</span><br><span class="line">                TEXT(<span class="string">&quot;第一个win api程序&quot;</span>),</span><br><span class="line">                <span class="number">-1</span>,</span><br><span class="line">                &amp;rect,</span><br><span class="line">                DT_SINGLELINE | DT_CENTER | DT_VCENTER</span><br><span class="line">            );</span><br><span class="line">            EndPaint (hwnd, &amp;ps) ;	<span class="comment">//在这里结束绘制</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">            PostQuitMessage(<span class="number">0</span>) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> DefWindowProc(hwnd, message, wParam, lParam) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="TextOut-函数"><a href="#TextOut-函数" class="headerlink" title="TextOut 函数"></a>TextOut 函数</h2><p>TextOut 函数可以在客户区输出一段文本，原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">TextOut</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC hdc,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nXStart,  <span class="comment">//开始输出位置的x坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nYStart,  <span class="comment">//开始输出位置的y坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPCTSTR lpString,  <span class="comment">//要输出的字符串</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> cbString  <span class="comment">//字符串的长度</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>每当发生WM_PAINT事件时，窗口就会发生重绘，这个时候需要向窗口输出文字：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hwnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    UINT message,</span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HDC         hdc;  <span class="comment">//设备环境句柄</span></span><br><span class="line">    PAINTSTRUCT ps;  <span class="comment">//存储绘图环境的相关信息</span></span><br><span class="line">    TCHAR szText[<span class="number">20</span>] = TEXT(<span class="string">&quot;欢迎来到C语言中文网&quot;</span>);</span><br><span class="line">    <span class="keyword">switch</span> (message)&#123;</span><br><span class="line">        <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">            <span class="comment">//开始绘图并返回环境句柄</span></span><br><span class="line">            hdc = BeginPaint (hwnd, &amp;ps);</span><br><span class="line">            <span class="comment">//输出文字</span></span><br><span class="line">            TextOut(hdc, <span class="number">50</span>, <span class="number">50</span>, szText, wcslen(szText));<span class="comment">//注意这里的宽字符</span></span><br><span class="line">            <span class="comment">//结束绘图并释放环境句柄</span></span><br><span class="line">            EndPaint (hwnd, &amp;ps) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">            PostQuitMessage(<span class="number">0</span>) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> DefWindowProc(hwnd, message, wParam, lParam) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DrawText函数"><a href="#DrawText函数" class="headerlink" title="DrawText函数"></a>DrawText函数</h2><p>TextOut 在一个起点开始输出文本，可以精确定位，不能自动换行；</p>
<p>DrawText 在指定区域内输出文本，可以控制格式对，齐居左、居中、居右，可以换行（DrawText 在内部其实也是调用TextOut ）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DrawText</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC hDC,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPCTSTR lpString,  <span class="comment">//将要输出的字符串</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nCount,  <span class="comment">//字符串的长度</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="comment">// 如果 nCount 为 -1，则表明 lpString 指向的字符串是以&#x27;\0&#x27;结束的，DrawText 会自动计算字符数。</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPRECT lpRect,  <span class="comment">//指向一个矩形区域的结构体 RECT 的指针</span></span></span></span><br><span class="line"><span class="params"><span class="function">    UINT uFormat  <span class="comment">//输出格式，有四种取值，它们可以任意组合</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数 uFormat 有四种取值，它们可以任意组合：用 | 隔开</p>
<ul>
<li>DT_CALCRECT：这个参数比较重要，可以使 DrawText 函数计算出输出文本的尺寸。如果输出文本有多行，DrawText 函数使用 lpRect 定义的矩形的宽度，并扩展矩形的底部以容纳输出文本的最后一行。如果输出文本只有一行，则 DrawText 函数改变矩形的右边界，以容纳下正文行的最后一个字符。出现上述任何一种情况。</li>
<li>DT_CENTER：指定文本水平居中显示。</li>
<li>DT_VCENTER：指定文本垂直居中显示。该标记只在单行文本输出时有效，所以它必须与DT_SINGLELINE结合使用。</li>
<li>DT_SINGLELINE：单行显示文本，回车和换行符都不断行。</li>
</ul>
<h1 id="Windows-GDI绘图基础与轻量进阶"><a href="#Windows-GDI绘图基础与轻量进阶" class="headerlink" title="Windows GDI绘图基础与轻量进阶"></a>Windows GDI绘图基础与轻量进阶</h1><p>1，简介：GDI 是 Graphics Device Interface 的缩写，称为图形设备接口，主要用来绘图，由动态链接库 GDI32.DLL 提供支持。Windows 本身也使用GDI来显示用户界面，比如菜单、滚动条、图标和鼠标指针等。</p>
<h2 id="GDI-基础"><a href="#GDI-基础" class="headerlink" title="GDI 基础"></a>GDI 基础</h2><h3 id="绘制矩形"><a href="#绘制矩形" class="headerlink" title="绘制矩形"></a>绘制矩形</h3><p>Rectangle 函数可以在窗口上绘制一个矩形，它的原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">Rectangle</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC hdc,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nLeftRect,  <span class="comment">//矩形左上角x坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nTopRect,  <span class="comment">//矩形左上角y坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nRightRect,  <span class="comment">//矩形右下角x坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nBottomRect  <span class="comment">//矩形右下角y坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>示例代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_PAINT:</span><br><span class="line">    hdc = BeginPaint(hwnd, &amp;ps);</span><br><span class="line">    Rectangle(hdc, <span class="number">50</span>, <span class="number">50</span>, <span class="number">150</span>, <span class="number">150</span>);</span><br><span class="line">    EndPaint(hwnd, &amp;ps);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br></pre></td></tr></table></figure>
<p>运行效果就是会在一个窗口内出现一个矩形。</p>
<h3 id="绘制圆形"><a href="#绘制圆形" class="headerlink" title="绘制圆形"></a>绘制圆形</h3><p>如果要绘制一个圆形，可以使用 RoundRect 函数，函数的原型是：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">RoundRect</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC hdc,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nLeftRect,  <span class="comment">//矩形左上角x坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nTopRect,  <span class="comment">//矩形左上角y坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nRightRect,  <span class="comment">//矩形右下角x坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nBottomRect,  <span class="comment">//矩形右下角y坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nWidth,  <span class="comment">//用来画圆角的椭圆的宽度</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nHeight  <span class="comment">//用来画圆角的椭圆的高度</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>当 nHeight &gt;= nBottomRect 且 nWidth = nRightRect 时，那么绘制出的就是一个圆</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RoundRect(hdc, <span class="number">20</span>, <span class="number">20</span>, <span class="number">150</span>, <span class="number">150</span>, <span class="number">150</span>, <span class="number">150</span>);</span><br></pre></td></tr></table></figure>
<h3 id="绘制椭圆"><a href="#绘制椭圆" class="headerlink" title="绘制椭圆"></a>绘制椭圆</h3><p>Ellipse() 函数可以用来绘制椭圆，它的原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">Ellipse</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC hdc,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nLeftRect,  <span class="comment">//左上角x坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nTopRect,  <span class="comment">//左上角y坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nRightRect,  <span class="comment">//右下角x坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nBottomRect  <span class="comment">//右下角y坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="绘制直线"><a href="#绘制直线" class="headerlink" title="绘制直线"></a>绘制直线</h3><p>确定起点使用 MoveToEx 函数。MoveToEx 用来指定画笔的起始位置，也就是从哪里开始画，它的原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">MoveToEx</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC hdc,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> x,  <span class="comment">//起始位置x坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> y,  <span class="comment">//起始位置y坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPPOINT lpPoint  <span class="comment">//指向用于保存当前位置的POINT结构体的指针，直接返回NULL</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面继续设置终点函数</span></span><br><span class="line">    <span class="function">BOOL <span class="title">LineTo</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC hdc,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> xEnd,  <span class="comment">//终点的x坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> yEnd  <span class="comment">//终点的y坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：win32不再支持 MoveTo，只支持它的扩展函数 MoveToEx。</p>
</blockquote>
<p>（在这里知道后面的Ex是原先api的拓展）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_PAINT:</span><br><span class="line">	hdc = BeginPaint(hwnd, &amp;ps);</span><br><span class="line">	GetClientRect(hwnd, &amp;rect);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//DrawText(hdc, TEXT(&quot;第一个真正的gui程序&quot;), -1, &amp;rect, DT_SINGLELINE | DT_CENTER | DT_VCENTER);</span></span><br><span class="line">	<span class="comment">//Rectangle(hdc, 50,50,20,20);//用来绘制矩形</span></span><br><span class="line">	<span class="comment">//RoundRect(hdc, 20, 20, 150, 150, 150, 150);//绘制圆角或者是绘制圆形</span></span><br><span class="line">	<span class="comment">//Ellipse(hdc, 20, 20, 180, 90);//绘制椭圆，也可以绘制圆形</span></span><br><span class="line">	<span class="comment">//Ellipse(hdc, 20, 20, 40, 40);//绘制圆形</span></span><br><span class="line">	MoveToEx(hdc, <span class="number">150</span>, <span class="number">150</span>, <span class="literal">NULL</span>); <span class="comment">//设定起始点,不保存当前点坐标</span></span><br><span class="line">	LineTo(hdc, <span class="number">200</span>, <span class="number">60</span>); <span class="comment">//第一条线</span></span><br><span class="line">	LineTo(hdc, <span class="number">250</span>, <span class="number">150</span>); <span class="comment">//第二条线</span></span><br><span class="line">	LineTo(hdc, <span class="number">150</span>, <span class="number">150</span>); <span class="comment">//第三条线</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	EndPaint(hwnd, &amp;ps);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//窗口销毁消息</span></span><br></pre></td></tr></table></figure>
<p>这样就可以绘制出一个三角形</p>
<h2 id="画笔和画刷"><a href="#画笔和画刷" class="headerlink" title="画笔和画刷"></a>画笔和画刷</h2><p>1.画笔就是划线的，画刷就是可以覆盖 一块区域</p>
<h3 id="创建和使用画笔"><a href="#创建和使用画笔" class="headerlink" title="创建和使用画笔"></a>创建和使用画笔</h3><p>1.上面的绘图使用的是Windows的默认画笔，也就是宽度为1个像素，颜色为黑色的画笔。</p>
<p>创建画笔的API函数为 CreatePen：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HPEN <span class="title">CreatePen</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nPenStyle,  <span class="comment">//画笔的样式</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nWidth,  <span class="comment">//画笔的宽度</span></span></span></span><br><span class="line"><span class="params"><span class="function">    COLORREF crColor  <span class="comment">//画笔的颜色</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"><span class="comment">//因为指定设备环境，所以新创建的画笔与当前设备环境并没有关联，无法使用。</span></span><br></pre></td></tr></table></figure>
<p>1.画笔样式 nPenStyle 有7种取值：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>宏定义</th>
<th>宏定义对应的值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>PS_SOLID</td>
<td>0</td>
<td>实线</td>
</tr>
<tr>
<td>PS_DASH</td>
<td>1</td>
<td>虚线（段线），要求画笔宽度 &lt;= 1</td>
</tr>
<tr>
<td>PS_DOT</td>
<td>2</td>
<td>点线，要求画笔宽度 &lt;= 1</td>
</tr>
<tr>
<td>PS_DASHDOT</td>
<td>3</td>
<td>线、点，要求画笔宽度 &lt;= 1</td>
</tr>
<tr>
<td>PS_DASHDOTDOT</td>
<td>4</td>
<td>线、点、点，要求画笔宽度 &lt;= 1</td>
</tr>
<tr>
<td>PS_NULL</td>
<td>5</td>
<td>不可见</td>
</tr>
<tr>
<td>PS_INSIDEFRAME</td>
<td>6</td>
<td>实线，但画笔宽度是向里扩展的</td>
</tr>
</tbody>
</table>
</div>
<p>2.画笔宽度 ：nWidth 指逻辑宽度。iWidth为 0 则意味着画笔宽度为一个像素。如果画笔样式为点线或者虚线，同时又指定一个大于 1 的画笔宽度，<strong>那么Windows将使用实线画笔来代替。</strong></p>
<p>3.画笔的颜色 crColor 可以直接使用 RGB 颜色。</p>
<h3 id="GDI对象"><a href="#GDI对象" class="headerlink" title="GDI对象"></a>GDI对象</h3><p>画笔、画刷、字体等被称为GDI对象。可以供 GDI 函数使用。新创建的 GDI 对象必须通过 <code>SelectObject</code> 函数选入设备环境才能使用。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HGDIOBJ <span class="title">SelectObject</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC hdc,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    HGDIOBJ ho  <span class="comment">//GDI对象句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//窗口过程</span></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span>&#123;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    <span class="comment">//定义一个画笔句柄,请定义为静态变量</span></span><br><span class="line">    <span class="keyword">static</span> HPEN hPen;</span><br><span class="line">    <span class="keyword">switch</span> (message)&#123;</span><br><span class="line">        <span class="keyword">case</span> WM_CREATE:</span><br><span class="line">            <span class="comment">//创建宽度为2个像素的红色点线画笔，保存句柄到 hPen 变量</span></span><br><span class="line">            hPen = CreatePen(PS_SOLID, <span class="number">2</span>, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">            hdc = BeginPaint(hWnd, &amp;ps);</span><br><span class="line">            <span class="comment">//选入画笔到设备环境</span></span><br><span class="line">            SelectObject(hdc, hPen);</span><br><span class="line">            <span class="comment">//绘制三角形</span></span><br><span class="line">            MoveToEx(hdc, <span class="number">150</span>, <span class="number">150</span>, <span class="literal">NULL</span>);</span><br><span class="line">            LineTo(hdc,<span class="number">200</span>, <span class="number">60</span>); <span class="comment">//第一条线</span></span><br><span class="line">            LineTo(hdc, <span class="number">250</span>, <span class="number">150</span>); <span class="comment">//第二条线</span></span><br><span class="line">            LineTo(hdc, <span class="number">150</span>, <span class="number">150</span>); <span class="comment">//第三条线</span></span><br><span class="line">            EndPaint(hWnd, &amp;ps);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">            <span class="comment">//请做好善后工作,处理 WM_DESTROY 消息时删除之前我们创建的一切GDI对象</span></span><br><span class="line">            DeleteObject(hPen);</span><br><span class="line">            PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码会画一个红色的三角形。</p>
<p>画笔最好在 WM_CREATE 事件中创建，因为当应用程序运行时会频繁地触发 WM_PAINT 事件，比如窗口被覆盖后再显示、窗口被拖动、窗口被拉伸等，每次都需要重新创建画笔，浪费资源</p>
<h3 id="创建和使用画刷"><a href="#创建和使用画刷" class="headerlink" title="创建和使用画刷"></a>创建和使用画刷</h3><p>Windows API 中有两个函数可以用来创建画刷。</p>
<p>1.CreateSolidBrush 函数可以用来创建一个指定颜色的实心画刷</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HBRUSH <span class="title">CreateSolidBrush</span><span class="params">( COLORREF crColor )</span></span>;  <span class="comment">// crColor为画刷颜色</span></span><br></pre></td></tr></table></figure>
<p>2.CreateHatchBrush 函数可以用来创建一个指定颜色的含有特定阴影样式的画刷，原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HBRUSH <span class="title">CreateHatchBrush</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> fnStyle,  <span class="comment">//画刷样式，6种样式</span></span></span></span><br><span class="line"><span class="params"><span class="function">    COLORREF crColor  <span class="comment">//画刷颜色</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>HS_BDIGONAL：   45度向上，自左至右的阴影(///)</li>
<li>HS_CROSS：           表示水平直线和垂直直线交叉阴影(+++)</li>
<li>HS_DIAGCROSS： 45度交叉阴影(XXX)</li>
<li>HS_FDIAGONAL： 45度向下自左至右的阴影(\)</li>
<li>HS_HORIZONTAL：水平阴影(—-)</li>
<li>HS_VERTICAL：       垂直阴影</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//窗口过程</span></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span>&#123;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    <span class="comment">//定义两个画刷,请定义为静态变量</span></span><br><span class="line">    <span class="keyword">static</span> HBRUSH hSolidBrush;</span><br><span class="line">    <span class="keyword">static</span> HBRUSH hHatchBrush;</span><br><span class="line">    <span class="keyword">switch</span> (message)&#123;</span><br><span class="line">        <span class="keyword">case</span> WM_CREATE:</span><br><span class="line">            <span class="comment">//创建蓝色实心画刷，保存句柄到 hSolidBrush 变量</span></span><br><span class="line">            hSolidBrush = CreateSolidBrush(RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>));</span><br><span class="line">            <span class="comment">//创建绿色交叉阴影画刷，保存句柄到 hHatchBrush 变量</span></span><br><span class="line">            hHatchBrush = CreateHatchBrush(HS_DIAGCROSS,RGB(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">            hdc = BeginPaint(hWnd, &amp;ps);</span><br><span class="line">            <span class="comment">//选入蓝色实心画刷到设备环境</span></span><br><span class="line">            SelectObject(hdc, hSolidBrush);</span><br><span class="line">            Rectangle(hdc, <span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">100</span>); <span class="comment">//绘制矩形</span></span><br><span class="line">            <span class="comment">//选入绿色交叉画刷到设备环境</span></span><br><span class="line">            SelectObject(hdc, hHatchBrush);</span><br><span class="line">            Ellipse(hdc,<span class="number">0</span>,<span class="number">100</span>,<span class="number">200</span>,<span class="number">200</span>); <span class="comment">//绘制椭圆</span></span><br><span class="line">            EndPaint(hWnd, &amp;ps);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">            <span class="comment">//请做好善后工作,处理 WM_DESTROY 消息时删除之前我们创建的一切GDI对象。</span></span><br><span class="line">            DeleteObject(hSolidBrush);</span><br><span class="line">            DeleteObject(hHatchBrush);</span><br><span class="line">            PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上程序可以生成带颜色的长方形和矩形</p>
<h1 id="Windows-static控件"><a href="#Windows-static控件" class="headerlink" title="Windows static控件"></a>Windows static控件</h1><p>1.实际开发中一般使用静态文本框控件来输出文本。静态文本框是Windows 的一种<strong>标准控件</strong>，可以用来在窗口上显示一段文本，并且文本容易受到控制。除了静态文本框，<strong>Windows的标准控件还有很多种，例如按钮、下拉菜单、单选按钮、复选框等。</strong></p>
<p>2.<strong>控件是子窗口</strong>，创建时必须指定父窗口，这样控件才能有“归属”。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HWND <span class="title">CreateWindow</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    LPCWSTR lpClassName,  <span class="comment">//窗口类名</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPCWSTR lpWindowName,  <span class="comment">//窗体标题（或控件文本）</span></span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD dwStyle,  <span class="comment">//窗口/控件样式，WS开头</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> x,  <span class="comment">//窗口相对桌面（或子窗口相对父窗口）的 X 坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> y,  <span class="comment">//窗口相对桌面（或子窗口相对父窗口）的 Y 坐标</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nWidth,  <span class="comment">//窗体宽度</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nHeight,  <span class="comment">//窗体高度</span></span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hWndParent,  <span class="comment">//父窗口句柄，独立窗口，那么为 NULL，如果是控件，那么就需要父窗口的句柄。</span></span></span></span><br><span class="line"><span class="params"><span class="function">    HMENU hMenu,  <span class="comment">//菜单句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hInstance,  <span class="comment">//当前程序实例句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPVOID lpParam  <span class="comment">//一个指向某数值的指针</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p> lpWindowName 应传入窗口的标题，若你希望创建控件，则应传入控件的文本。</p>
<p>写起来程序和上面的程序差不多，但是有一个地方就是<code>`CreateWindow 函数传入的倒数第二个参数为 hInst</code>,表示当前程序的实例句柄。</p>
<p>当前实例句柄是通过 WinMain 函数的参数传入的，所以必须要定义一个全局变量 hInst，然后在 WinMain 中给它赋值后才能使用。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">HINSTANCE hInst;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hPrevInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">    PSTR szCmdLine,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> iCmdShow</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 其他代码</span></span><br><span class="line">    hInst = hInstance;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 其他代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完整代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</span><br><span class="line"></span><br><span class="line">HINSTANCE hInst;		<span class="comment">//hInst 在 WndProc 函数中并不存在，</span></span><br><span class="line">						<span class="comment">//因为当前实例句柄是通过 WinMain 函数的参数传入的，所以必须要定义一个全局变量 hInst，然后在 WinMain 中给它赋值后才能使用。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR szCmdLine, <span class="keyword">int</span> iCmdShow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> TCHAR szClassName[] = <span class="string">L&quot;HelloWinStatic&quot;</span>;  <span class="comment">//窗口类名</span></span><br><span class="line"></span><br><span class="line">	HWND     hwnd;  <span class="comment">//窗口句柄</span></span><br><span class="line">	MSG      msg;  <span class="comment">//消息</span></span><br><span class="line">	WNDCLASS wndclass;  <span class="comment">//窗口类</span></span><br><span class="line">	hInst = hInstance;</span><br><span class="line"> <span class="comment">/**********第①步：注册窗口类**********/</span></span><br><span class="line">	<span class="comment">//为窗口类的各个字段赋值</span></span><br><span class="line">	wndclass.style = CS_HREDRAW | CS_VREDRAW;  <span class="comment">//窗口风格</span></span><br><span class="line">	wndclass.lpfnWndProc = WndProc;  <span class="comment">//窗口过程</span></span><br><span class="line">	wndclass.cbClsExtra = <span class="number">0</span>;  <span class="comment">//暂时不需要理解</span></span><br><span class="line">	wndclass.cbWndExtra = <span class="number">0</span>;  <span class="comment">//暂时不需要理解</span></span><br><span class="line">	wndclass.hInstance = hInstance;  <span class="comment">//当前窗口句柄</span></span><br><span class="line">	wndclass.hIcon = LoadIcon(<span class="literal">NULL</span>, IDI_APPLICATION);  <span class="comment">//窗口图标</span></span><br><span class="line">	wndclass.hCursor = LoadCursor(<span class="literal">NULL</span>, IDC_ARROW);  <span class="comment">//鼠标样式</span></span><br><span class="line">	wndclass.hbrBackground = (HBRUSH)GetStockObject(WHITE_BRUSH);  <span class="comment">//窗口背景画刷</span></span><br><span class="line">	wndclass.lpszMenuName = <span class="literal">NULL</span>;  <span class="comment">//窗口菜单</span></span><br><span class="line">	wndclass.lpszClassName = szClassName;  <span class="comment">//窗口类名</span></span><br><span class="line">	<span class="comment">//注册窗口</span></span><br><span class="line">	RegisterClass(&amp;wndclass);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*****第②步：创建窗口(并让窗口显示出来)*****/</span></span><br><span class="line">	hwnd = CreateWindow(</span><br><span class="line">								szClassName,  <span class="comment">//窗口类的名字</span></span><br><span class="line">								TEXT(<span class="string">&quot;Welcome2Static&quot;</span>),  <span class="comment">//窗口标题（出现在标题栏）</span></span><br><span class="line">								WS_OVERLAPPEDWINDOW,  <span class="comment">//窗口风格</span></span><br><span class="line">								CW_USEDEFAULT,  <span class="comment">//初始化时x轴的位置</span></span><br><span class="line">								CW_USEDEFAULT,  <span class="comment">//初始化时y轴的位置</span></span><br><span class="line">								<span class="number">500</span>,  <span class="comment">//窗口宽度</span></span><br><span class="line">								<span class="number">500</span>,  <span class="comment">//窗口高度</span></span><br><span class="line">								<span class="literal">NULL</span>,  <span class="comment">//父窗口句柄</span></span><br><span class="line">								<span class="literal">NULL</span>,  <span class="comment">//窗口菜单句柄</span></span><br><span class="line">								hInstance,  <span class="comment">//当前窗口的句柄</span></span><br><span class="line">								<span class="literal">NULL</span>  <span class="comment">//不使用该值</span></span><br><span class="line">						);</span><br><span class="line">	<span class="comment">//显示窗口</span></span><br><span class="line">	ShowWindow(hwnd, iCmdShow);</span><br><span class="line">	<span class="comment">//更新（绘制）窗口</span></span><br><span class="line">	UpdateWindow(hwnd);</span><br><span class="line">	<span class="comment">/**********第③步：消息循环**********/</span></span><br><span class="line">	<span class="keyword">while</span> (GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</span><br><span class="line">		TranslateMessage(&amp;msg);  <span class="comment">//翻译消息</span></span><br><span class="line">		DispatchMessage(&amp;msg);  <span class="comment">//分派消息</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> msg.wParam;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	HWND hWnd,</span></span></span><br><span class="line"><span class="params"><span class="function">	UINT message,</span></span></span><br><span class="line"><span class="params"><span class="function">	WPARAM wParam,</span></span></span><br><span class="line"><span class="params"><span class="function">	LPARAM lParam</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">	PAINTSTRUCT ps;</span><br><span class="line">	HDC hdc;</span><br><span class="line">	HWND hStatic;</span><br><span class="line">	<span class="keyword">switch</span> (message) &#123;</span><br><span class="line">	<span class="keyword">case</span>  WM_CREATE:</span><br><span class="line">		hStatic = CreateWindow(</span><br><span class="line">			<span class="string">L&quot;static&quot;</span>, <span class="comment">//静态文本框的类名</span></span><br><span class="line">			<span class="string">L&quot;C语言中文网&quot;</span>,  <span class="comment">//控件的文本</span></span><br><span class="line">			WS_CHILD <span class="comment">/*子窗口*/</span> | WS_VISIBLE <span class="comment">/*创建时显示*/</span> | WS_BORDER <span class="comment">/*带边框*/</span> | SS_CENTER <span class="comment">/*水平居中*/</span> | SS_CENTERIMAGE <span class="comment">/*垂直居中*/</span>,</span><br><span class="line">			<span class="number">20</span> <span class="comment">/*X坐标*/</span>, <span class="number">20</span> <span class="comment">/*Y坐标*/</span>, <span class="number">200</span> <span class="comment">/*宽度*/</span>, <span class="number">100</span> <span class="comment">/*高度*/</span>,</span><br><span class="line">			hWnd,  <span class="comment">//父窗口句柄</span></span><br><span class="line">			(HMENU)<span class="number">1</span>,  <span class="comment">//为控件指定一个唯一标识符</span></span><br><span class="line">			hInst,  <span class="comment">//当前程序实例句柄</span></span><br><span class="line">			<span class="literal">NULL</span></span><br><span class="line">		);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> WM_PAINT:</span><br><span class="line">		hdc = BeginPaint(hWnd, &amp;ps);</span><br><span class="line">		<span class="comment">// <span class="doctag">TODO:</span>  在此添加任意绘图代码...</span></span><br><span class="line">		EndPaint(hWnd, &amp;ps);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">		PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="获取、修改控件文本"><a href="#获取、修改控件文本" class="headerlink" title="获取、修改控件文本"></a>获取、修改控件文本</h2><p>1.GetWindowText 函数用于将指定窗口的标题文本（如果存在）拷贝到一个缓存区内；如果指定的窗口是一个控件，则拷贝控件的文本。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Int <span class="title">GetWindowText</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hWnd,  <span class="comment">//窗口/控件句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPTSTR lpString,  <span class="comment">//指向接收文本的缓冲区指针</span></span></span></span><br><span class="line"><span class="params"><span class="function">    Int nMaxCount  <span class="comment">//要保存在缓冲区内的字符的最大个数，包含NULL字符。文本超过界被截断。</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>2.类似的函数：<code>SetWindowText</code>，用来设置窗口标题或者控件文本。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">SetWindowText</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hwnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPCTSTR lpString</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>如下代码显示鼠标点击次数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</span><br><span class="line"></span><br><span class="line">HINSTANCE hInst;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hPrevInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">    PSTR szCmdLine,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> iCmdShow</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> TCHAR szClassName[] = TEXT(<span class="string">&quot;Win32Demo&quot;</span>); </span><br><span class="line">    HWND     hwnd;  </span><br><span class="line">    MSG      msg;  </span><br><span class="line">    WNDCLASS wndclass; </span><br><span class="line"></span><br><span class="line">    hInst = hInstance;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    wndclass.style = CS_HREDRAW | CS_VREDRAW;  </span><br><span class="line">    wndclass.lpfnWndProc = WndProc; </span><br><span class="line">    wndclass.cbClsExtra = <span class="number">0</span>;  </span><br><span class="line">    wndclass.cbWndExtra = <span class="number">0</span>;  </span><br><span class="line">    wndclass.hInstance = hInstance;  </span><br><span class="line">    wndclass.hIcon = LoadIcon(<span class="literal">NULL</span>, IDI_APPLICATION); </span><br><span class="line">    wndclass.hCursor = LoadCursor(<span class="literal">NULL</span>, IDC_ARROW);  </span><br><span class="line">    wndclass.hbrBackground = (HBRUSH)GetStockObject(WHITE_BRUSH);; </span><br><span class="line">    wndclass.lpszMenuName = <span class="literal">NULL</span>;  </span><br><span class="line">    wndclass.lpszClassName = szClassName;  </span><br><span class="line"></span><br><span class="line">    RegisterClass(&amp;wndclass);</span><br><span class="line"></span><br><span class="line">    hwnd = CreateWindow(</span><br><span class="line">        szClassName,  </span><br><span class="line">        TEXT(<span class="string">&quot;Welcome&quot;</span>),  </span><br><span class="line">        WS_OVERLAPPEDWINDOW,  </span><br><span class="line">        CW_USEDEFAULT,  </span><br><span class="line">        CW_USEDEFAULT,  </span><br><span class="line">        <span class="number">500</span>,  </span><br><span class="line">        <span class="number">300</span>,  </span><br><span class="line">        <span class="literal">NULL</span>, </span><br><span class="line">        <span class="literal">NULL</span>,  </span><br><span class="line">        hInstance,  </span><br><span class="line">        <span class="literal">NULL</span>  </span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ShowWindow(hwnd, iCmdShow);</span><br><span class="line">   </span><br><span class="line">    UpdateWindow(hwnd);</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">while</span> (GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</span><br><span class="line">        TranslateMessage(&amp;msg); </span><br><span class="line">        DispatchMessage(&amp;msg);  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> msg.wParam;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hWnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    UINT message,</span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> iClick = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">static</span> TCHAR szTextBuf[<span class="number">20</span>];  </span><br><span class="line">    <span class="keyword">static</span> HWND hStatic;  <span class="comment">//静态变量是因为防止在creat结束的时候会销毁无法使用</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (message) &#123;</span><br><span class="line">    <span class="keyword">case</span>  WM_CREATE:</span><br><span class="line">        hStatic = CreateWindow(</span><br><span class="line">            <span class="string">L&quot;static&quot;</span>, </span><br><span class="line">            <span class="string">L&quot;LALALALALALALA&quot;</span>,  </span><br><span class="line">            WS_CHILD  | WS_VISIBLE  | WS_BORDER  | SS_CENTER  | SS_CENTERIMAGE ,</span><br><span class="line">            <span class="number">20</span> , <span class="number">20</span> , <span class="number">200</span> , <span class="number">100</span> ,</span><br><span class="line">            hWnd,  </span><br><span class="line">            (HMENU)<span class="number">1</span>,  </span><br><span class="line">            hInst,  </span><br><span class="line">            <span class="literal">NULL</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">        hdc = BeginPaint(hWnd, &amp;ps);</span><br><span class="line">        EndPaint(hWnd, &amp;ps);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_RBUTTONDOWN:</span><br><span class="line">        iClick++;</span><br><span class="line">        wsprintf(szTextBuf, TEXT(<span class="string">&quot;%d&quot;</span>), iClick);<span class="comment">//往缓冲区写东西的函数</span></span><br><span class="line">        SetWindowText(hStatic, szTextBuf);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">        PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.对于窗口函数中的变量，如果是在 WM_CREATE 消息中赋值，但在其他消息中使用，那么一般声明为静态变量，这样下次执行窗口函数时依然有效。尤其是这种窗口会不断变化的函数</p>
<h1 id="Windows-CreateFont：创建自己的字体"><a href="#Windows-CreateFont：创建自己的字体" class="headerlink" title="Windows CreateFont：创建自己的字体"></a>Windows CreateFont：创建自己的字体</h1><p>创建字体使用 CreateFont 函数，它的原型是：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HFONT <span class="title">CreateFont</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> cHeight,  <span class="comment">//字体的逻辑高度</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> cWidth,  <span class="comment">//字体的逻辑宽度，一般取负数，高是宽的两倍</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> cEscapement,  <span class="comment">//指定移位向量相对X轴的偏转角度</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> cOrientation,  <span class="comment">//指定字符基线相对X轴的偏转角度</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> cWeight,  <span class="comment">//设置字体粗细程度，可以使用 FW_ 开头的宏定义；一般取 FW_NORMAL (400)，此参数需要值的值域为 [0,1000]。</span></span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD bItalic,  <span class="comment">//是否启用斜体</span></span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD bUnderline,  <span class="comment">//是否启用下划线</span></span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD bStrikeOut,  <span class="comment">//是否启用删除线。以上这仨，直接TRUE或者FALSE取值就可以</span></span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD iCharSet,  <span class="comment">//指定字符集，直接使用 DEFAULT_CHARSET 让系统自动处理。</span></span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD iOutPrecision,  <span class="comment">//输出精度</span></span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD iClipPrecision,  <span class="comment">//剪裁精度</span></span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD iQuality,  <span class="comment">//输出质量</span></span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD iPitchAndFamily,  <span class="comment">//字体族</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPCSTR pszFaceName  <span class="comment">//字体名</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p><strong>注意：字体也是一种 GDI 对象，使用完后也要在 WM_DESTROY 消息中删除。</strong></p>
<p>1.创建完字体后并不能立即使用，还需要手动触发 <strong>WM_SETFONT</strong> 消息（设置字体的消息），让Windows 将当前字体设置为我们创建的字体。</p>
<p>2.发送消息使用 SendMessage 函数，它可以让我们在必要时主动向窗口发送各种消息，原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT <span class="title">SendMessage</span><span class="params">(	<span class="comment">//SendMessage 发送的消息就是由窗口过程来处理的。</span></span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hWnd,  <span class="comment">//发送消息的目标窗口句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    UINT msg,  <span class="comment">//将要发送的消息</span></span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,  <span class="comment">//附加消息1， 传入 CreateFont 返回的句柄即可</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam  <span class="comment">//附加消息2</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<h1 id="Windows-button控件（按钮控件）"><a href="#Windows-button控件（按钮控件）" class="headerlink" title="Windows button控件（按钮控件）"></a>Windows button控件（按钮控件）</h1><p>1.按钮既是标准控件，也是子窗口，窗口类名是<code>button</code>。</p>
<p>2.Button 控件样式以<code>BS</code>开头</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>样式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>BS_LEFT</td>
<td>文本居左。</td>
</tr>
<tr>
<td>BS_RIGHT</td>
<td>文本居右。</td>
</tr>
<tr>
<td>BS_CENTER</td>
<td>文本水平居中（默认为 BS_CENTER）。</td>
</tr>
<tr>
<td>BS_BOTTOM</td>
<td>文本位于按钮底部。</td>
</tr>
<tr>
<td>BS_TOP</td>
<td>文本位于按钮顶部。</td>
</tr>
<tr>
<td>BS_VCENTER</td>
<td>文本垂直居中（默认为 BS_VCENTER）。</td>
</tr>
<tr>
<td>BS_FLAT</td>
<td>扁平样式。默认情况下按钮具有3D阴影效果。</td>
</tr>
<tr>
<td>BS_MULTILINE</td>
<td>允许显示多行文本。也就是说当文本过长时会自动换行。</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hWnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    UINT message,</span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> wmId, wmEvent;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    <span class="keyword">static</span> HFONT hFont;</span><br><span class="line">    <span class="keyword">static</span> HWND hBtn;</span><br><span class="line">    <span class="keyword">switch</span> (message)&#123;</span><br><span class="line">        <span class="keyword">case</span>  WM_CREATE:</span><br><span class="line">            <span class="comment">//创建逻辑字体</span></span><br><span class="line">            hFont = CreateFont(</span><br><span class="line">                <span class="number">-15</span><span class="comment">/*高度*/</span>, <span class="number">-7.5</span><span class="comment">/*宽度*/</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span> <span class="comment">/*一般这个值设为400*/</span>,</span><br><span class="line">                FALSE<span class="comment">/*不带斜体*/</span>, FALSE<span class="comment">/*不带下划线*/</span>, FALSE<span class="comment">/*不带删除线*/</span>,</span><br><span class="line">                DEFAULT_CHARSET,  <span class="comment">//使用默认字符集</span></span><br><span class="line">                OUT_CHARACTER_PRECIS, CLIP_CHARACTER_PRECIS,  <span class="comment">//这行参数不用管</span></span><br><span class="line">                DEFAULT_QUALITY,  <span class="comment">//默认输出质量</span></span><br><span class="line">                FF_DONTCARE,  <span class="comment">//不指定字体族*/</span></span><br><span class="line">                TEXT(<span class="string">&quot;微软雅黑&quot;</span>)  <span class="comment">//字体名</span></span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//创建按钮控件</span></span><br><span class="line">            hBtn = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>), <span class="comment">//按钮控件的类名</span></span><br><span class="line">                TEXT(<span class="string">&quot;这是按钮&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | WS_BORDER | BS_FLAT<span class="comment">/*扁平样式*/</span>,</span><br><span class="line">                <span class="number">30</span> <span class="comment">/*X坐标*/</span>, <span class="number">20</span> <span class="comment">/*Y坐标*/</span>, <span class="number">150</span> <span class="comment">/*宽度*/</span>, <span class="number">50</span><span class="comment">/*高度*/</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">2</span> <span class="comment">/*控件唯一标识符*/</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            SendMessage(hBtn, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);<span class="comment">//设置按钮字体</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">            hdc = BeginPaint(hWnd, &amp;ps);</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span>  在此添加任意绘图代码...</span></span><br><span class="line">            EndPaint(hWnd, &amp;ps);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">            <span class="comment">//请做好善后工作</span></span><br><span class="line">            DeleteObject(hFont);</span><br><span class="line">            PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上代码就设置了一个内容是“这是按钮”的控件</p>
<p>关于如何捕获到按钮的消息</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hWnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    UINT message,</span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> wmId, wmEvent;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    <span class="keyword">static</span> HFONT hFont;</span><br><span class="line">    <span class="keyword">static</span> HWND hBtn;</span><br><span class="line">    <span class="keyword">static</span> HWND hStatic;</span><br><span class="line">    <span class="keyword">switch</span> (message)&#123;</span><br><span class="line">        <span class="keyword">case</span>  WM_CREATE:</span><br><span class="line">            <span class="comment">//创建逻辑字体</span></span><br><span class="line">            hFont = CreateFont(</span><br><span class="line">                <span class="number">-15</span><span class="comment">/*高度*/</span>, <span class="number">-7.5</span><span class="comment">/*宽度*/</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span> <span class="comment">/*一般这个值设为400*/</span>,</span><br><span class="line">                FALSE<span class="comment">/*不带斜体*/</span>, FALSE<span class="comment">/*不带下划线*/</span>, FALSE<span class="comment">/*不带删除线*/</span>,</span><br><span class="line">                DEFAULT_CHARSET,  <span class="comment">//使用默认字符集</span></span><br><span class="line">                OUT_CHARACTER_PRECIS, CLIP_CHARACTER_PRECIS,  <span class="comment">//这行参数不用管</span></span><br><span class="line">                DEFAULT_QUALITY,  <span class="comment">//默认输出质量</span></span><br><span class="line">                FF_DONTCARE,  <span class="comment">//不指定字体族*/</span></span><br><span class="line">                TEXT(<span class="string">&quot;微软雅黑&quot;</span>)  <span class="comment">//字体名</span></span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//创建静态文本控件</span></span><br><span class="line">            hStatic = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;static&quot;</span>),  <span class="comment">//静态文本框的类名</span></span><br><span class="line">                TEXT(<span class="string">&quot;你好，欢迎来到C语言中文网&quot;</span>),  <span class="comment">//控件的文本</span></span><br><span class="line">                WS_CHILD <span class="comment">/*子窗口*/</span> | WS_VISIBLE <span class="comment">/*创建时显示*/</span> | WS_BORDER <span class="comment">/*带边框*/</span>,</span><br><span class="line">                <span class="number">30</span> <span class="comment">/*X坐标*/</span>, <span class="number">20</span><span class="comment">/*Y坐标*/</span>, <span class="number">150</span><span class="comment">/*宽度*/</span>, <span class="number">80</span><span class="comment">/*高度*/</span>, hWnd<span class="comment">/*父窗口句柄*/</span>,</span><br><span class="line">                (HMENU)<span class="number">1</span>,  <span class="comment">//为控件指定一个唯一标识符</span></span><br><span class="line">                hInst,  <span class="comment">//当前实例句柄</span></span><br><span class="line">                <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//创建按钮控件</span></span><br><span class="line">            hBtn = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>),  <span class="comment">//按钮控件的类名</span></span><br><span class="line">                TEXT(<span class="string">&quot;点击这里试试&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | WS_BORDER | BS_FLAT<span class="comment">/*扁平样式*/</span>,</span><br><span class="line">                <span class="number">30</span> <span class="comment">/*X坐标*/</span>, <span class="number">110</span> <span class="comment">/*Y坐标*/</span>, <span class="number">150</span> <span class="comment">/*宽度*/</span>, <span class="number">50</span><span class="comment">/*高度*/</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">2</span> <span class="comment">/*控件唯一标识符*/</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            SendMessage(hStatic,WM_SETFONT,(WPARAM)hFont,<span class="literal">NULL</span>);<span class="comment">//设置文本框字体</span></span><br><span class="line">            SendMessage(hBtn, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);<span class="comment">//设置按钮字体</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">            wmId    = LOWORD(wParam);</span><br><span class="line">            wmEvent = HIWORD(wParam);</span><br><span class="line">            <span class="keyword">switch</span> (wmId)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:  <span class="comment">//按下按钮</span></span><br><span class="line">                    <span class="comment">//更改文本框的内容</span></span><br><span class="line">                    SetWindowText( hStatic, TEXT(<span class="string">&quot;你点击了下面的按钮&quot;</span>) );</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="comment">//不处理的消息一定要交给 DefWindowProc 处理。</span></span><br><span class="line">                    <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">            hdc = BeginPaint(hWnd, &amp;ps);</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span>  在此添加任意绘图代码...</span></span><br><span class="line">            EndPaint(hWnd, &amp;ps);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">            <span class="comment">//请做好善后工作</span></span><br><span class="line">            DeleteObject(hFont);</span><br><span class="line">            PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Windows-edit控件（编辑框控件）"><a href="#Windows-edit控件（编辑框控件）" class="headerlink" title="Windows edit控件（编辑框控件）"></a>Windows edit控件（编辑框控件）</h1><p>1.相当于是控制台程序的scanf函数</p>
<p>2.编辑框控件的窗口类名是<code>edit</code>。除了子窗口常用的风格 WS_CHILD、WS_VISIBLE、WS_BORDER 外，edit 控件也有自己的风格，都是以<code>ES</code>开头。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>风格</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ES_AUTOHSCROLL</td>
<td>当输入文字超出横向显示范围时自动滚动（一般必选）。</td>
</tr>
<tr>
<td>ES_AUTOVSCROLL</td>
<td>当输入文字超出纵向显示范围时自动滚动。</td>
</tr>
<tr>
<td>ES_CENTER</td>
<td>文本居中对齐。</td>
</tr>
<tr>
<td>ES_LEFT</td>
<td>文本左对齐（默认）。</td>
</tr>
<tr>
<td>ES_RIGHT</td>
<td>文本右对齐。</td>
</tr>
<tr>
<td>ES_MULTILINE</td>
<td>是否允许多行输入。</td>
</tr>
<tr>
<td>ES_PASSWORD</td>
<td>是否为密码输入框，如果指明该风格则输入的文字显示为“<em>*</em>”。</td>
</tr>
<tr>
<td>ES_READONLY</td>
<td>是否为只读。禁止用户输入或修改编辑控件中的文本。</td>
</tr>
<tr>
<td>ES_UPPERCASE</td>
<td>显示大写字符。</td>
</tr>
<tr>
<td>ES_LOWERCASE</td>
<td>显示小写字符。</td>
</tr>
<tr>
<td>ES_LOWERCASE</td>
<td>将用户输入到编辑控件的字符全部转换为小写。</td>
</tr>
<tr>
<td>ES_UPPERCASE</td>
<td>将用户输入到编辑控件的字符全部转换为大写。</td>
</tr>
<tr>
<td>ES_MULTILINE</td>
<td>指明了一个多行编辑控件（缺省的是单行的）。  1) 如果指定了ES_AUTOVSCROLL风格，编辑控件将显示尽可能多的文本，并且当用户按下ENTER键时会自动地垂直滚动文本。  2) 如果没有指定ES_AUTOVSCROLL风格，则编辑控件将显示尽可能多的行，如果在按下ENTER键却没有更多的行要显示的话，就发出蜂鸣声。  3) 如果指定了ES_AUTOHSCROLL风格，当光标到达控件的右边时，多行编辑控件会自动地水平滚动文本。如果要开始一个新行，用户必须按下ENTER键。  4) 如果没有指定ES_AUTOHSCROLL风格，控件会在有必要时自动将单词折合到下一行的开始。如果按下ENTER键，则另起一行。折回单词的位置是由窗口的大小决定的。如果窗口的大小发生改变，折回单词的位置也会反生改变，将会重新显示文本。</td>
</tr>
</tbody>
</table>
</div>
<p>实例程序，登录框</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span>    <span class="comment">//代码段2 完整的窗口</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</span><br><span class="line"></span><br><span class="line">HINSTANCE hInst;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR szCmdLine, <span class="keyword">int</span> iCmdShow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> TCHAR szClassName[] = TEXT(<span class="string">&quot;HelloWin&quot;</span>);  <span class="comment">//窗口类名</span></span><br><span class="line"></span><br><span class="line">    HWND     hwnd;  <span class="comment">//窗口句柄</span></span><br><span class="line">    MSG      msg;  <span class="comment">//消息</span></span><br><span class="line">    WNDCLASS wndclass;  <span class="comment">//窗口类</span></span><br><span class="line"></span><br><span class="line">    hInst = hInstance;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**********第①步：注册窗口类**********/</span></span><br><span class="line">    <span class="comment">//为窗口类的各个字段赋值</span></span><br><span class="line">    wndclass.style = CS_HREDRAW | CS_VREDRAW;  <span class="comment">//窗口风格</span></span><br><span class="line">    wndclass.lpfnWndProc = WndProc;  <span class="comment">//窗口过程</span></span><br><span class="line">    wndclass.cbClsExtra = <span class="number">0</span>;  <span class="comment">//暂时不需要理解</span></span><br><span class="line">    wndclass.cbWndExtra = <span class="number">0</span>;  <span class="comment">//暂时不需要理解</span></span><br><span class="line">    wndclass.hInstance = hInstance;  <span class="comment">//当前窗口句柄</span></span><br><span class="line">    wndclass.hIcon = LoadIcon(<span class="literal">NULL</span>, IDI_APPLICATION);  <span class="comment">//窗口图标</span></span><br><span class="line">    wndclass.hCursor = LoadCursor(<span class="literal">NULL</span>, IDC_ARROW);  <span class="comment">//鼠标样式</span></span><br><span class="line">    wndclass.hbrBackground = (HBRUSH)GetStockObject(WHITE_BRUSH);  <span class="comment">//窗口背景画刷</span></span><br><span class="line">    wndclass.lpszMenuName = <span class="literal">NULL</span>;  <span class="comment">//窗口菜单</span></span><br><span class="line">    wndclass.lpszClassName = szClassName;  <span class="comment">//窗口类名</span></span><br><span class="line">    <span class="comment">//注册窗口</span></span><br><span class="line">    RegisterClass(&amp;wndclass);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*****第②步：创建窗口(并让窗口显示出来)*****/</span></span><br><span class="line">    hwnd = CreateWindow(</span><br><span class="line">        szClassName,  <span class="comment">//窗口类的名字</span></span><br><span class="line">        TEXT(<span class="string">&quot;Welcome&quot;</span>),  <span class="comment">//窗口标题（出现在标题栏）</span></span><br><span class="line">        WS_OVERLAPPEDWINDOW,  <span class="comment">//窗口风格</span></span><br><span class="line">        CW_USEDEFAULT,  <span class="comment">//初始化时x轴的位置</span></span><br><span class="line">        CW_USEDEFAULT,  <span class="comment">//初始化时y轴的位置</span></span><br><span class="line">        <span class="number">500</span>,  <span class="comment">//窗口宽度</span></span><br><span class="line">        <span class="number">300</span>,  <span class="comment">//窗口高度</span></span><br><span class="line">        <span class="literal">NULL</span>,  <span class="comment">//父窗口句柄</span></span><br><span class="line">        <span class="literal">NULL</span>,  <span class="comment">//窗口菜单句柄</span></span><br><span class="line">        hInstance,  <span class="comment">//当前窗口的句柄</span></span><br><span class="line">        <span class="literal">NULL</span>  <span class="comment">//不使用该值</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//显示窗口</span></span><br><span class="line">    ShowWindow(hwnd, iCmdShow);</span><br><span class="line">    <span class="comment">//更新（绘制）窗口</span></span><br><span class="line">    UpdateWindow(hwnd);</span><br><span class="line">    <span class="comment">/**********第③步：消息循环**********/</span></span><br><span class="line">    <span class="keyword">while</span> (GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</span><br><span class="line">        TranslateMessage(&amp;msg);  <span class="comment">//翻译消息</span></span><br><span class="line">        DispatchMessage(&amp;msg);  <span class="comment">//分派消息</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> msg.wParam;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> wmId, wmEvent;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    <span class="keyword">static</span> HFONT hFont;  <span class="comment">//逻辑字体</span></span><br><span class="line">    <span class="keyword">static</span> HWND hLabUsername;  <span class="comment">//静态文本框--用户名</span></span><br><span class="line">    <span class="keyword">static</span> HWND hLabPassword;  <span class="comment">//静态文本框--密码</span></span><br><span class="line">    <span class="keyword">static</span> HWND hEditUsername;  <span class="comment">//单行文本输入框</span></span><br><span class="line">    <span class="keyword">static</span> HWND hEditPassword;  <span class="comment">//密码输入框</span></span><br><span class="line">    <span class="keyword">static</span> HWND hBtnLogin;  <span class="comment">//登录按钮</span></span><br><span class="line">    <span class="comment">//定义缓冲区</span></span><br><span class="line">    TCHAR szUsername[<span class="number">100</span>];</span><br><span class="line">    TCHAR szPassword[<span class="number">100</span>];</span><br><span class="line">    TCHAR szUserInfo[<span class="number">200</span>];</span><br><span class="line">    <span class="keyword">switch</span> (message) &#123;</span><br><span class="line">    <span class="keyword">case</span>  WM_CREATE:</span><br><span class="line">        <span class="comment">//创建逻辑字体</span></span><br><span class="line">        hFont = CreateFont(<span class="number">-14</span><span class="comment">/*高*/</span>, <span class="number">-7</span><span class="comment">/*宽*/</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span> <span class="comment">/*一般这个值设为400*/</span>,</span><br><span class="line">            FALSE<span class="comment">/*斜体?*/</span>, FALSE<span class="comment">/*下划线?*/</span>, FALSE<span class="comment">/*删除线?*/</span>, DEFAULT_CHARSET,</span><br><span class="line">            OUT_CHARACTER_PRECIS, CLIP_CHARACTER_PRECIS, DEFAULT_QUALITY,</span><br><span class="line">            FF_DONTCARE, TEXT(<span class="string">&quot;微软雅黑&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//创建静态文本框控件--用户名</span></span><br><span class="line">        hLabUsername = CreateWindow(TEXT(<span class="string">&quot;static&quot;</span>), TEXT(<span class="string">&quot;用户名：&quot;</span>),</span><br><span class="line">            WS_CHILD | WS_VISIBLE | SS_CENTERIMAGE <span class="comment">/*垂直居中*/</span> | SS_RIGHT <span class="comment">/*水平居右*/</span>,</span><br><span class="line">            <span class="number">0</span> <span class="comment">/*x坐标*/</span>, <span class="number">20</span> <span class="comment">/*y坐标*/</span>, <span class="number">70</span> <span class="comment">/*宽度*/</span>, <span class="number">26</span> <span class="comment">/*高度*/</span>,</span><br><span class="line">            hWnd <span class="comment">/*父窗口句柄*/</span>, (HMENU)<span class="number">1</span> <span class="comment">/*控件ID*/</span>, hInst <span class="comment">/*当前程序实例句柄*/</span>, <span class="literal">NULL</span></span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//创建静态文本框控件--密码</span></span><br><span class="line">        hLabPassword = CreateWindow(TEXT(<span class="string">&quot;static&quot;</span>), TEXT(<span class="string">&quot;密码：&quot;</span>),</span><br><span class="line">            WS_CHILD | WS_VISIBLE | SS_CENTERIMAGE <span class="comment">/*垂直居中*/</span> | SS_RIGHT <span class="comment">/*水平居右*/</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">56</span>, <span class="number">70</span>, <span class="number">26</span>,</span><br><span class="line">            hWnd, (HMENU)<span class="number">2</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//创建单行文本框控件</span></span><br><span class="line">        hEditUsername = CreateWindow(TEXT(<span class="string">&quot;edit&quot;</span>), TEXT(<span class="string">&quot;&quot;</span>),</span><br><span class="line">            WS_CHILD | WS_VISIBLE | WS_BORDER <span class="comment">/*边框*/</span> | ES_AUTOHSCROLL <span class="comment">/*水平滚动*/</span>,</span><br><span class="line">            <span class="number">80</span>, <span class="number">20</span>, <span class="number">200</span>, <span class="number">26</span>,</span><br><span class="line">            hWnd, (HMENU)<span class="number">3</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//创建密码输入框</span></span><br><span class="line">        hEditPassword = CreateWindow(TEXT(<span class="string">&quot;edit&quot;</span>), TEXT(<span class="string">&quot;&quot;</span>),</span><br><span class="line">            WS_CHILD | WS_VISIBLE | WS_BORDER | ES_PASSWORD <span class="comment">/*密码*/</span> | ES_AUTOHSCROLL <span class="comment">/*水平滚动*/</span>,</span><br><span class="line">            <span class="number">80</span>, <span class="number">56</span>, <span class="number">200</span>, <span class="number">26</span>,</span><br><span class="line">            hWnd, (HMENU)<span class="number">4</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//创建按钮控件</span></span><br><span class="line">        hBtnLogin = CreateWindow(TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;登录&quot;</span>),</span><br><span class="line">            WS_CHILD | WS_VISIBLE | WS_BORDER | BS_FLAT<span class="comment">/*扁平样式*/</span>,</span><br><span class="line">            <span class="number">80</span>, <span class="number">92</span>, <span class="number">200</span>, <span class="number">30</span>,</span><br><span class="line">            hWnd, (HMENU)<span class="number">5</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//依次设置控件的字体</span></span><br><span class="line">        SendMessage(hLabUsername, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">        SendMessage(hLabPassword, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">        SendMessage(hEditUsername, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">        SendMessage(hEditPassword, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">        SendMessage(hBtnLogin, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">        wmId = LOWORD(wParam);</span><br><span class="line">        wmEvent = HIWORD(wParam);</span><br><span class="line">        <span class="keyword">switch</span> (wmId) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:  <span class="comment">//按钮的HMENU参数</span></span><br><span class="line">            <span class="comment">//获取输入框的数据</span></span><br><span class="line">            GetWindowText(hEditUsername, szUsername, <span class="number">100</span>);</span><br><span class="line">            GetWindowText(hEditPassword, szPassword, <span class="number">100</span>);</span><br><span class="line">            wsprintf(szUserInfo, TEXT(<span class="string">&quot;C语言中文网提示：\r\n您的用户账号：%s\r\n您的用户密码：%s&quot;</span>), szUsername, szPassword);</span><br><span class="line">            MessageBox(hWnd, szUserInfo, TEXT(<span class="string">&quot;信息提示&quot;</span>), MB_ICONINFORMATION);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">        hdc = BeginPaint(hWnd, &amp;ps);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span>  在此添加任意绘图代码...</span></span><br><span class="line">        EndPaint(hWnd, &amp;ps);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">        DeleteObject(hFont);</span><br><span class="line">        PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="修改static控件背景颜色和文字颜色"><a href="#修改static控件背景颜色和文字颜色" class="headerlink" title="修改static控件背景颜色和文字颜色"></a>修改static控件背景颜色和文字颜色</h1><p>1.当 static 控件或具有 ES_READONLY 风格的 edit 控件被绘制时，会向父窗口发送 WM_CTLCOLORSTATIC 消息。如果我们在窗口过程中处理该消息，就必须返回一个画刷句柄，Windows 会使用该画刷来绘制控件背景（子窗口背景）。</p>
<p>所以，改变空间颜色的方法就是<strong>处理 WM_CTLCOLORSTATIC 消息。</strong></p>
<h2 id="修改文字背景颜色"><a href="#修改文字背景颜色" class="headerlink" title="修改文字背景颜色"></a>修改文字背景颜色</h2><p>1.修改文字背景颜色使用 SetBkColor 函数，它的原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">COLORREF <span class="title">SetBkColor</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC      hdc,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    COLORREF crColor  <span class="comment">//背景颜色</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>2.修改文字前景色（文字颜色）使用 SetTextColor 函数，它的原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">COLORREF <span class="title">SetTextColor</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC      hdc,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    COLORREF crColor  <span class="comment">//背景颜色</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这里我们修改的是 static 控件中的文本颜色，所以需要获取 static 控件的设备环境句柄。</p>
<p>非常巧妙的是，发送 WM_CTLCOLORSTATIC 消息时，<strong>wParam 参数表示的就是 static 控件的设备环境句柄（lParam 表示控件句柄）。</strong></p>
<h2 id="透明背景"><a href="#透明背景" class="headerlink" title="透明背景"></a>透明背景</h2><p>实现透明背景需要设置文本背景颜色透明，同时返回没有颜色的画刷。</p>
<p>1.SetBkMode 函数可以用来设置文本的背景模式，它的原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">SetBkMode</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HDC hdc,  <span class="comment">//设备环境句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> iBkMode  <span class="comment">//背景模式</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>iBkMode 有下面两种取值：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>取值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>OPAQUE</td>
<td>使用当前背景颜色来填充背景。</td>
</tr>
<tr>
<td>TRANSPARENT</td>
<td>背景透明。</td>
</tr>
</tbody>
</table>
</div>
<p>2.GetStockObject (NULL_BRUSH); 语句可以返回没有颜色的画刷。示例代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_CTLCOLORSTATIC:</span><br><span class="line">    hdcStatic = (HDC)wParam;</span><br><span class="line">    SetTextColor( hdcStatic, RGB(<span class="number">0x41</span>, <span class="number">0x96</span>, <span class="number">0x4F</span>) );  <span class="comment">//翠绿色</span></span><br><span class="line">    SetBkMode(hdcStatic, TRANSPARENT);  <span class="comment">//透明背景</span></span><br><span class="line">    <span class="keyword">return</span> (INT_PTR)GetStockObject(NULL_BRUSH);  <span class="comment">//无颜色画刷</span></span><br></pre></td></tr></table></figure>
<h1 id="Windows单选按钮、复选框、分组框控件"><a href="#Windows单选按钮、复选框、分组框控件" class="headerlink" title="Windows单选按钮、复选框、分组框控件"></a>Windows单选按钮、复选框、分组框控件</h1><p>单选按钮和复选框都是一种特殊的按钮，窗口类名称都是<code>button</code></p>
<p>单选按钮的样式为<code>BS_AUTORADIOBUTTON</code>，复选框的样式为<code>BS_AUTOCHECKBOX</code>。例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个单选按钮</span></span><br><span class="line">CreateWindow(</span><br><span class="line">    TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;单选按钮&quot;</span>),</span><br><span class="line">    WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTORADIOBUTTON<span class="comment">/*单选按钮*/</span>,</span><br><span class="line">    <span class="number">235</span>, <span class="number">40</span>, <span class="number">100</span>, <span class="number">26</span>,</span><br><span class="line">    hWnd, (HMENU)<span class="number">7</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">//创建一个复选框</span></span><br><span class="line">CreateWindow(</span><br><span class="line">    TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;复选框&quot;</span>),</span><br><span class="line">    WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTOCHECKBOX<span class="comment">/*复选框*/</span>,</span><br><span class="line">    <span class="number">95</span>, <span class="number">70</span>, <span class="number">50</span>, <span class="number">26</span>,</span><br><span class="line">    hWnd, (HMENU)<span class="number">9</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>想为<strong>单选按钮分组</strong>，可以增加<code>WS_GROUP</code>样式。设置了 WS_GROUP 样式的单选框为一组中的首元素，随后的所有单选按钮都和它在同一组，直到下一个设置了 WS_GROUP 样式的单选按钮。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//窗口过程</span></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span>&#123;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    <span class="keyword">static</span> HFONT hFont;  <span class="comment">//逻辑字体</span></span><br><span class="line">    <span class="comment">//一组单选按钮</span></span><br><span class="line">    <span class="keyword">static</span> HWND labSex;  <span class="comment">//静态文本框--性别</span></span><br><span class="line">    <span class="keyword">static</span> HWND radioMale;  <span class="comment">//单选按钮--男</span></span><br><span class="line">    <span class="keyword">static</span> HWND radioFemale;  <span class="comment">//单选按钮--女</span></span><br><span class="line">    <span class="comment">//一组单选按钮</span></span><br><span class="line">    <span class="keyword">static</span> HWND labMarriage;  <span class="comment">//静态文本框--婚姻状况</span></span><br><span class="line">    <span class="keyword">static</span> HWND radioMarried;  <span class="comment">//单选按钮--已婚</span></span><br><span class="line">    <span class="keyword">static</span> HWND radioSingle;  <span class="comment">//单选按钮--未婚</span></span><br><span class="line">    <span class="keyword">static</span> HWND radioSecrecy;  <span class="comment">//单选按钮--保密</span></span><br><span class="line">    <span class="comment">//一组复选框</span></span><br><span class="line">    <span class="keyword">static</span> HWND labPet;  <span class="comment">//静态文本框--你的宠物</span></span><br><span class="line">    <span class="keyword">static</span> HWND checkboxDog;  <span class="comment">//复选框--狗</span></span><br><span class="line">    <span class="keyword">static</span> HWND checkboxCat;  <span class="comment">//复选框--猫</span></span><br><span class="line">    <span class="keyword">static</span> HWND checkboxFish;  <span class="comment">//复选框--鱼</span></span><br><span class="line">    <span class="keyword">static</span> HWND checkboxOther;  <span class="comment">//复选框--其他</span></span><br><span class="line">    <span class="keyword">switch</span> (message)&#123;</span><br><span class="line">        <span class="keyword">case</span>  WM_CREATE:</span><br><span class="line">            hFont = CreateFont(</span><br><span class="line">                <span class="number">-14</span>, <span class="number">-7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>,</span><br><span class="line">                FALSE, FALSE, FALSE,DEFAULT_CHARSET,</span><br><span class="line">                OUT_CHARACTER_PRECIS, CLIP_CHARACTER_PRECIS, DEFAULT_QUALITY,</span><br><span class="line">                FF_DONTCARE, TEXT(<span class="string">&quot;微软雅黑&quot;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//选择性别</span></span><br><span class="line">            labSex = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;static&quot;</span>), TEXT(<span class="string">&quot;你的性别：&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | SS_CENTERIMAGE | SS_RIGHT<span class="comment">/*文字居右*/</span>,</span><br><span class="line">                <span class="number">10</span>, <span class="number">10</span>, <span class="number">80</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">1</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            radioMale = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;男&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | BS_LEFT<span class="comment">/*文字居左*/</span> | BS_AUTORADIOBUTTON <span class="comment">/*单选按钮*/</span> | WS_GROUP,</span><br><span class="line">                <span class="number">95</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">2</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            radioFemale = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;女&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTORADIOBUTTON,</span><br><span class="line">                <span class="number">150</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">2</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//选择婚姻状况</span></span><br><span class="line">            labMarriage = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;static&quot;</span>), TEXT(<span class="string">&quot;婚姻状况：&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | SS_CENTERIMAGE | SS_RIGHT,</span><br><span class="line">                <span class="number">10</span>, <span class="number">40</span>, <span class="number">80</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">4</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            radioMarried = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;已婚&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTORADIOBUTTON | WS_GROUP,</span><br><span class="line">                <span class="number">95</span>, <span class="number">40</span>, <span class="number">65</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">5</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            radioSingle = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;未婚&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTORADIOBUTTON,</span><br><span class="line">                <span class="number">165</span>, <span class="number">40</span>, <span class="number">65</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">6</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            radioSecrecy = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;保密&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTORADIOBUTTON,</span><br><span class="line">                <span class="number">235</span>, <span class="number">40</span>, <span class="number">100</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">7</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//你的宠物</span></span><br><span class="line">            labPet = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;static&quot;</span>), TEXT(<span class="string">&quot;你的宠物：&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | SS_CENTERIMAGE | SS_RIGHT,</span><br><span class="line">                <span class="number">10</span>, <span class="number">70</span>, <span class="number">80</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">8</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">           </span><br><span class="line">            checkboxDog = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;狗&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTOCHECKBOX<span class="comment">/*复选框*/</span>,</span><br><span class="line">                <span class="number">95</span>, <span class="number">70</span>, <span class="number">50</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">9</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            checkboxCat = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;猫&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTOCHECKBOX,</span><br><span class="line">                <span class="number">150</span>, <span class="number">70</span>, <span class="number">50</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">10</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            checkboxFish = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;鱼&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTOCHECKBOX,</span><br><span class="line">                <span class="number">205</span>, <span class="number">70</span>, <span class="number">50</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">11</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            checkboxOther = CreateWindow(</span><br><span class="line">                TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;其他&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTOCHECKBOX,</span><br><span class="line">                <span class="number">260</span>, <span class="number">70</span>, <span class="number">65</span>, <span class="number">26</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">11</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            SendMessage(labSex, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(radioMale, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(radioFemale, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(labMarriage, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(radioMarried, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(radioSingle, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(radioSecrecy, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(labPet, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(checkboxDog, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(checkboxCat, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(checkboxFish, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            SendMessage(checkboxOther, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">            hdc = BeginPaint(hWnd, &amp;ps);</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span>  在此添加任意绘图代码...</span></span><br><span class="line">            EndPaint(hWnd, &amp;ps);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">            PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="分组框控件"><a href="#分组框控件" class="headerlink" title="分组框控件"></a>分组框控件</h2><p>分组框控件也是一种特殊的按钮，它的样式为<code>BS_GROUPBOX</code>，例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建分组框控件</span></span><br><span class="line">hGroupSex = CreateWindow(</span><br><span class="line">    TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;你的性别&quot;</span>),</span><br><span class="line">    WS_CHILD | WS_VISIBLE | BS_GROUPBOX,</span><br><span class="line">    <span class="number">20</span>, <span class="number">20</span>, <span class="number">300</span>, <span class="number">70</span>,</span><br><span class="line">    hWnd, (HMENU)<span class="number">1</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">//接下来添加单选按钮</span></span><br><span class="line">hRadioMale = CreateWindow(</span><br><span class="line">    TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;男&quot;</span>),</span><br><span class="line">    WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTORADIOBUTTON <span class="comment">/*单选按钮*/</span>,</span><br><span class="line">    <span class="number">15</span>, <span class="number">30</span>, <span class="number">50</span>, <span class="number">26</span>,</span><br><span class="line">    hGroupSex <span class="comment">/*父窗口为 GroupBox 控件*/</span>, (HMENU)<span class="number">2</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line">hRadioFemale = CreateWindow(</span><br><span class="line">    TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;女&quot;</span>),</span><br><span class="line">    WS_CHILD | WS_VISIBLE | BS_LEFT | BS_AUTORADIOBUTTON,</span><br><span class="line">    <span class="number">80</span>, <span class="number">30</span>, <span class="number">50</span>, <span class="number">26</span>,</span><br><span class="line">    hGroupSex, (HMENU)<span class="number">3</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>注意父子窗口关系：需要注意的是：单选按钮的父窗口为分组框控件 hGroupSex，而不是顶级窗口 hWnd。</p>
<h1 id="判断单选按钮和复选框是否被选中"><a href="#判断单选按钮和复选框是否被选中" class="headerlink" title="判断单选按钮和复选框是否被选中"></a>判断单选按钮和复选框是否被选中</h1><p>对于一组单选按钮，只有一个选项能被选中，最好的办法是将这组按钮作为参数传入一个函数，通过函数返回值判断哪个按钮被选中了。</p>
<p>但遗憾的是<strong>，在Windows中不能一次性获得一组按钮的选中状态，只能一个一个地遍历。复选框也是如此。</strong></p>
<p>解决：可以通过<code>SendMessage</code>函数发送<code>BM_GETCHECK</code>消息来获取按钮的选中状态，返回 BST_CHECKED 表示按钮被选中，返回 BST_UNCHECKED 是未被选中。</p>
<p>SendMessage 原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT WINAPI <span class="title">SendMessage</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND   hWnd,  <span class="comment">//窗口（控件）句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    UINT   Msg,  <span class="comment">//消息类型</span></span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,  <span class="comment">//附加消息1</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam  <span class="comment">//附加消息2</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>
<p><strong>注意：发送 BM_GETCHECK 消息时，wParam 和 lParam 两个参数必须都为 0。</strong></p>
<p>如果被选中，那么会获取按钮文本并保存到缓冲区：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( SendMessage(hCheckBox, BM_GETCHECK, <span class="number">0</span>, <span class="number">0</span>) == BST_CHECKED )</span><br><span class="line">&#123;</span><br><span class="line">    GetWindowText(hCheckBox, szBuffer,  <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序部分</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> wmId, wmEvent;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    <span class="comment">//设置缓冲区</span></span><br><span class="line">    <span class="keyword">static</span> TCHAR szBufSex[<span class="number">10</span>];  <span class="comment">//保存性别</span></span><br><span class="line">    <span class="keyword">static</span> TCHAR szBufMarriage[<span class="number">10</span>];  <span class="comment">//保存婚姻状况</span></span><br><span class="line">    <span class="keyword">static</span> TCHAR szBufPet[<span class="number">20</span>];  <span class="comment">//保存宠物</span></span><br><span class="line">    <span class="keyword">static</span> TCHAR szBufSubmit[<span class="number">100</span>];  <span class="comment">//保存提交时显示的文本</span></span><br><span class="line">    <span class="keyword">static</span> TCHAR szBufTmp[<span class="number">10</span>];  <span class="comment">//临时缓冲区</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为了节省空间，这里省略了各种控件句柄的定义</span></span><br><span class="line"><span class="comment">     * 这里的代码与上节相同，请参考上节代码</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="keyword">static</span> HWND btnSubmit;  <span class="comment">//按钮控件</span></span><br><span class="line">    <span class="keyword">switch</span> (message)&#123;</span><br><span class="line">        <span class="keyword">case</span>  WM_CREATE:</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 为了节省空间，这里省略了创建各种控件的语句</span></span><br><span class="line"><span class="comment">             * 这里的代码与上节相同，请参考上节代码</span></span><br><span class="line"><span class="comment">            **/</span></span><br><span class="line">            <span class="comment">//创建按钮控件</span></span><br><span class="line">            btnSubmit = CreateWindow(TEXT(<span class="string">&quot;button&quot;</span>), TEXT(<span class="string">&quot;提 交&quot;</span>),</span><br><span class="line">                WS_CHILD | WS_VISIBLE | WS_BORDER | BS_FLAT,</span><br><span class="line">                <span class="number">95</span>, <span class="number">110</span>, <span class="number">200</span>, <span class="number">36</span>,</span><br><span class="line">                hWnd, (HMENU)<span class="number">13</span>, hInst, <span class="literal">NULL</span></span><br><span class="line">            );</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 为了节省空间，这里省略了设置字体的语句</span></span><br><span class="line"><span class="comment">             * 这里的代码与上节相同，请参考上节代码</span></span><br><span class="line"><span class="comment">            **/</span></span><br><span class="line">            SendMessage(btnSubmit, WM_SETFONT, (WPARAM)hFont, <span class="literal">NULL</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//这里是重点</span></span><br><span class="line">        <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">            wmId    = LOWORD(wParam);</span><br><span class="line">            wmEvent = HIWORD(wParam);</span><br><span class="line">            <span class="keyword">if</span>( wmEvent==  BN_CLICKED)&#123;</span><br><span class="line">                <span class="keyword">switch</span> (wmId)&#123;</span><br><span class="line">                    <span class="comment">//获取性别</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                        GetWindowText((HWND)lParam, szBufSex, <span class="number">10</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="comment">//获取婚姻状况</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                        GetWindowText((HWND)lParam, szBufMarriage, <span class="number">10</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="comment">//获取宠物</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">                        <span class="built_in">memset</span>(szBufPet, <span class="number">0</span>, <span class="keyword">sizeof</span>(szBufPet));</span><br><span class="line">                        <span class="comment">//是否选中狗</span></span><br><span class="line">                        <span class="keyword">if</span>( SendMessage(checkboxDog, BM_GETCHECK, <span class="number">0</span>, <span class="number">0</span>) == BST_CHECKED )&#123;</span><br><span class="line">                            GetWindowText(checkboxDog, szBufTmp,  <span class="number">10</span>);</span><br><span class="line">                            wsprintf(szBufPet, TEXT(<span class="string">&quot;%s  %s&quot;</span>), szBufPet, szBufTmp);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//是否选中猫</span></span><br><span class="line">                        <span class="keyword">if</span>( SendMessage(checkboxCat, BM_GETCHECK, <span class="number">0</span>, <span class="number">0</span>) == BST_CHECKED )&#123;</span><br><span class="line">                            GetWindowText(checkboxCat, szBufTmp, <span class="number">10</span>);</span><br><span class="line">                            wsprintf(szBufPet, TEXT(<span class="string">&quot;%s  %s&quot;</span>), szBufPet, szBufTmp);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//是否选中鱼</span></span><br><span class="line">                        <span class="keyword">if</span>( SendMessage(checkboxFish, BM_GETCHECK, <span class="number">0</span>, <span class="number">0</span>) == BST_CHECKED )&#123;</span><br><span class="line">                            GetWindowText(checkboxFish, szBufTmp, <span class="number">10</span>);</span><br><span class="line">                            wsprintf(szBufPet, TEXT(<span class="string">&quot;%s  %s&quot;</span>), szBufPet, szBufTmp);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//是否选中其他</span></span><br><span class="line">                        <span class="keyword">if</span>( SendMessage(checkboxOther, BM_GETCHECK, <span class="number">0</span>, <span class="number">0</span>) == BST_CHECKED )&#123;</span><br><span class="line">                            GetWindowText(checkboxOther, szBufTmp, <span class="number">10</span>);</span><br><span class="line">                            wsprintf(szBufPet, TEXT(<span class="string">&quot;%s  %s&quot;</span>), szBufPet, szBufTmp);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="comment">//点击提交按钮</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">13</span>:</span><br><span class="line">                        wsprintf(szBufSubmit, TEXT(<span class="string">&quot;你的性别：%s\n婚姻状况：%s\r\n你的宠物：%s&quot;</span>), szBufSex, szBufMarriage, szBufPet);</span><br><span class="line">                        MessageBox(hWnd, szBufSubmit, TEXT(<span class="string">&quot;信息提示&quot;</span>), MB_ICONINFORMATION);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 为了节省空间，这里省略了部分语句</span></span><br><span class="line"><span class="comment">         * 这里的代码与上节相同，请参考上节代码</span></span><br><span class="line"><span class="comment">        **/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.用户点击控件时会产生 WM_COMMAND 消息，这时 wParam 参数的低16位表示控件ID，高16位表示控件通知码，lParam 表示控件句柄。</p>
<p>2.对于单选按钮，根据控件ID判断当前按钮是否被选中，是的话就获取按钮文本，保存到缓冲区。</p>
<p>3.对于复选框，根据控件ID判断当前复选框是否被选中，是的话就需要<strong>遍历所有复选框</strong>，检测它们的选中状态，并将所有被选中的复选框的文本保存到缓冲区。</p>
<p><strong><em>PS:单选按钮可以不发送 BM_GETCHECK 消息，因为一组中只能有一个被选中，就是当前被点击的这个。而复选框就不同了，一组中可以有多个被选中，所以必须发送 BM_GETCHECK 消息检测其他复选框的选中状态。</em></strong></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Windows%E7%BC%96%E7%A8%8B/" rel="tag"># Windows编程</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/01/17/JEB%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/" rel="prev" title="apk重打包动态调试">
                  <i class="fa fa-chevron-left"></i> apk重打包动态调试
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/02/27/zhuanzhuan-Winrar/" rel="next" title="转转大师v6.0.0.6破解">
                  转转大师v6.0.0.6破解 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
但使龙城飞将在，不教胡马度阴山。

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rootkit/+-*</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>


    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>




  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
